<!doctype html>



  


<html class="theme-next pisces use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="阅读,Spring,Java,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="书接上文 接下来到 Spring framework core 的第三大块 —— 验证、数据绑定和类型转换">
<meta name="keywords" content="阅读,Spring,Java">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring进阶 - 验证、数据绑定和类型转换">
<meta property="og:url" content="https://HaleLu.github.io/2020/05/spring-4/index.html">
<meta property="og:site_name" content="Move your idea forward.">
<meta property="og:description" content="书接上文 接下来到 Spring framework core 的第三大块 —— 验证、数据绑定和类型转换">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-06-05T10:53:36.507Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring进阶 - 验证、数据绑定和类型转换">
<meta name="twitter:description" content="书接上文 接下来到 Spring framework core 的第三大块 —— 验证、数据绑定和类型转换">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6279916590628603000,
      author: '（博主大人~）'
    }
  };
</script>

  <title> Spring进阶 - 验证、数据绑定和类型转换 | Move your idea forward. </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-77199457-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Move your idea forward.</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hale Lu's Blog</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br>
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Spring进阶 - 验证、数据绑定和类型转换
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-27T03:57:10+08:00" content="2020-05-27">
              2020-05-27
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2020/05/spring-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/05/spring-4/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2020/05/spring-4/" class="leancloud_visitors" data-flag-title="Spring进阶 - 验证、数据绑定和类型转换">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>书接<a href="https://halelu.github.io/2020/05/spring-3/">上文</a></p>
<p>接下来到 Spring framework core 的第三大块 —— 验证、数据绑定和类型转换</p>
<a id="more"></a>

<h1 id="验证、数据绑定和类型转换"><a href="#验证、数据绑定和类型转换" class="headerlink" title="验证、数据绑定和类型转换"></a>验证、数据绑定和类型转换</h1><p>考虑将验证作为业务逻辑有利有弊，Spring 提供了一种验证（和数据绑定）设计。具体来说，验证不应与 Web 层绑定，并且应该易于本地化，并且应该可以插入任何可用的验证器。考虑到这些问题，Spring 提供了一个 <code>Validator</code> 合同，该合同既基本又可以在应用程序的每个层中使用。</p>
<p>数据绑定对于使用户输入动态绑定到应用程序的域模型（或用于处理用户输入的任何对象）非常有用。Spring 提供了恰当地命名为 <code>DataBinder</code> 的功能。 <code>Validator</code> 和 <code>DataBinder</code> 组成了验证包，该验证包主要用于但不限于 Web 层。</p>
<p><code>BeanWrapper</code> 是 Spring 框架中的基本概念，并在很多地方使用。但是，您可能不需要直接使用 <code>BeanWrapper</code>。但是，因为这是参考文档，所以我们认为可能需要进行一些解释。我们将在本章中解释 <code>BeanWrapper</code>，因为如果您要使用它，那么在尝试将数据绑定到对象时最有可能使用它。</p>
<p>Spring 的 <code>DataBinder</code> 和较低级别的 <code>BeanWrapper</code> 都使用 <code>PropertyEditorSupport</code> 实现来解析和格式化属性值。 <code>PropertyEditor</code> 和 <code>PropertyEditorSupport</code> 类型是 JavaBeans 规范的一部分，本章还将对此进行说明。 Spring 3 引入了 <code>core.convert</code> 包，该包提供了常规的类型转换工具，以及用于格式化 UI 字段值的高级“format”包。您可以将这些包用作 <code>PropertyEditorSupport</code> 实现的更简单替代方案。本章还将对它们进行讨论。</p>
<p>Spring 通过设置基础结构和 Spring 自己的 <code>Validator</code> 合同的适配器来支持 Java Bean 验证。应用程序可以全局启用一次 Bean 验证，如 Java Bean 验证中所述，并将其专用于所有验证需求。在 Web 层中，应用程序可以每个 <code>DataBinder</code> 进一步注册控制器本地的 Spring <code>Validator</code> 实例，如配置 <code>DataBinder</code> 中所述，这对于插入自定义验证逻辑很有用。</p>
<h2 id="使用-Spring-的-Validator-接口进行验证"><a href="#使用-Spring-的-Validator-接口进行验证" class="headerlink" title="使用 Spring 的 Validator 接口进行验证"></a>使用 Spring 的 Validator 接口进行验证</h2><p>Spring 具有 <code>Validator</code> 接口，可用于验证对象。 <code>Validator</code> 接口通过使用 <code>Errors</code> 对象来工作，以便验证器在验证时可以将验证失败报告给 <code>Errors</code> 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the usual getters and setters...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下一个示例通过实现 <code>org.springframework.validation.Validator</code> 接口的以下两个方法来提供 <code>Person</code> 类的验证行为：</p>
<ul>
<li><code>supports(Class)</code>：此验证程序可以验证提供的 Class 的实例吗？</li>
<li><code>validate(Object, org.springframework.validation.Errors)</code>：验证给定的对象，并在发生验证错误的情况下，向给定的 <code>Errors</code> 对象注册这些对象。</li>
</ul>
<p>实施 <code>Validator</code> 非常简单，尤其是当您知道 Spring Framework 也提供的 <code>ValidationUtils</code> 帮助器类时。 以下示例实现了用于 <code>Person</code> 实例的 <code>Validator</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonValidator</span> <span class="keyword">implements</span> <span class="title">Validator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This Validator validates only Person instances</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Person.class.equals(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">(Object obj, Errors e)</span> </span>&#123;</span><br><span class="line">        ValidationUtils.rejectIfEmpty(e, <span class="string">"name"</span>, <span class="string">"name.empty"</span>);</span><br><span class="line">        Person p = (Person) obj;</span><br><span class="line">        <span class="keyword">if</span> (p.getAge() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            e.rejectValue(<span class="string">"age"</span>, <span class="string">"negativevalue"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.getAge() &gt; <span class="number">110</span>) &#123;</span><br><span class="line">            e.rejectValue(<span class="string">"age"</span>, <span class="string">"too.darn.old"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ValidationUtils</code> 类上的静态 <code>rejectIfEmpty(..)</code>方法用于拒绝 name 属性（如果该属性为 null 或为空字符串）。查看 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/ValidationUtils.html" target="_blank" rel="noopener"><code>ValidationUtils</code> javadoc</a>，看看它除了提供前面显示的示例外还提供什么功能。</p>
<p>虽然可以实现单个 <code>Validator</code> 类来验证丰富对象中的每个嵌套对象，但最好在其自己的 <code>Validator</code> 实现中封装对象的每个嵌套类的验证逻辑。一个“丰富”对象的简单示例是一个 <code>Customer</code>，它由两个 String 属性（第一个和第二个名称）和一个复杂的 <code>Address</code> 对象组成。地址对象可以独立于客户对象使用，因此已实现了不同的 <code>AddressValidator</code>。如果希望 <code>CustomerValidator</code> 重用 <code>AddressValidator</code> 类中包含的逻辑而不求助于复制和粘贴，则可以在 <code>CustomerValidator</code> 中依赖注入或实例化一个 <code>AddressValidator</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerValidator</span> <span class="keyword">implements</span> <span class="title">Validator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator addressValidator;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerValidator</span><span class="params">(Validator addressValidator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (addressValidator == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The supplied [Validator] is "</span> +</span><br><span class="line">                <span class="string">"required and must not be null."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!addressValidator.supports(Address.class)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The supplied [Validator] must "</span> +</span><br><span class="line">                <span class="string">"support the validation of [Address] instances."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.addressValidator = addressValidator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This Validator validates Customer instances, and any subclasses of Customer too</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Customer.class.isAssignableFrom(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">(Object target, Errors errors)</span> </span>&#123;</span><br><span class="line">        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="string">"firstName"</span>, <span class="string">"field.required"</span>);</span><br><span class="line">        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="string">"surname"</span>, <span class="string">"field.required"</span>);</span><br><span class="line">        Customer customer = (Customer) target;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            errors.pushNestedPath(<span class="string">"address"</span>);</span><br><span class="line">            ValidationUtils.invokeValidator(<span class="keyword">this</span>.addressValidator, customer.getAddress(), errors);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            errors.popNestedPath();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>验证错误将报告给传递给验证器的 <code>Errors</code> 对象。 对于 Spring Web MVC，可以使用 <code>&lt;spring:bind/&gt;</code> 标记检查错误消息，但是也可以自己检查 <code>Errors</code> 对象。关于它提供的方法的更多信息可以在 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframeworkvalidation/Errors.html" target="_blank" rel="noopener">javadoc</a> 中找到。</p>
<h2 id="将代码解析为错误消息"><a href="#将代码解析为错误消息" class="headerlink" title="将代码解析为错误消息"></a>将代码解析为错误消息</h2><p>我们介绍了数据绑定和验证。本节介绍与验证错误相对应的输出消息。在上一节显示的示例中，我们拒绝了名称和年龄字段。如果要使用 <code>MessageSource</code> 输出错误消息，可以使用拒绝字段时提供的错误代码（在这种情况下为“名称”和“年龄”）来进行输出。当您从 <code>Errors</code> 接口调用（直接或间接通过使用诸如 <code>ValidationUtils</code> 类的直接或间接）<code>rejectValue</code> 或其他拒绝方法之一时，基础实现不仅注册您传入的代码，还注册许多其他错误代码。<code>MessageCodesResolver</code> 确定 <code>Errors</code> 接口寄存器中的哪个错误代码。默认情况下，使用 <code>DefaultMessageCodesResolver</code>，它（例如）不仅使用您提供的代码注册消息，而且还注册包含传递给拒绝方法的字段名称的消息。因此，如果您通过使用 <code>rejectValue(&quot;age&quot;, &quot;too.darn.old&quot;)</code> 拒绝字段，除了 <code>too.darn.old</code> 代码外，Spring 还会注册 <code>too.darn.old.age</code> 和 <code>too.darn.old.age.int</code>（第一个包含字段名称，第二个包含字段类型）。这样做是为了方便开发人员在定位错误消息时提供帮助。</p>
<p>有关 MessageCodesResolver 和默认策略的更多信息，可以分别在 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/MessageCodesResolver.html" target="_blank" rel="noopener"><code>MessageCodesResolver</code></a> 和 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.html" target="_blank" rel="noopener"><code>DefaultMessageCodesResolver</code></a> 的 javadoc 中找到。</p>
<h2 id="Bean-操作和-BeanWrapper"><a href="#Bean-操作和-BeanWrapper" class="headerlink" title="Bean 操作和 BeanWrapper"></a>Bean 操作和 BeanWrapper</h2><p><code>org.springframework.beans</code> 包遵循 JavaBeans 标准。 JavaBean 是具有默认无参数构造函数的类，并且遵循命名约定，在该命名约定下，例如，名为 <code>bingoMadness</code> 的属性将具有 setter 方法 <code>setBingoMadness(..)</code> 和 getter 方法 <code>getBingoMadness()</code>。有关 JavaBean 和规范的更多信息，请参见 <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/package-summary.html" target="_blank" rel="noopener">javabeans</a>。</p>
<p>Bean 包中的一个非常重要的类是 <code>BeanWrapper</code> 接口及其相应的实现（<code>BeanWrapperImpl</code>）。就像从 Javadoc 引用的那样，<code>BeanWrapper</code> 提供了以下功能：设置和获取属性值（单独或批量），获取属性描述符以及查询属性以确定它们是否可读或可写。此外，<code>BeanWrapper</code> 还支持嵌套属性，从而可以将子属性上的属性设置为无限深度。 <code>BeanWrapper</code> 还支持添加标准 JavaBeans <code>PropertyChangeListeners</code> 和 <code>VetoableChangeListeners</code> 的功能，而无需在目标类中支持代码。最后但并非最不重要的一点是，<code>BeanWrapper</code> 支持设置索引属性。 <code>BeanWrapper</code> 通常不直接由应用程序代码使用，而是由 <code>DataBinder</code> 和 <code>BeanFactory</code> 使用。</p>
<p><code>BeanWrapper</code> 的工作方式部分由其名称表示：它包装一个 Bean，以对该 Bean 执行操作，例如设置和检索属性。</p>
<h3 id="设置和获取基本和嵌套属性"><a href="#设置和获取基本和嵌套属性" class="headerlink" title="设置和获取基本和嵌套属性"></a>设置和获取基本和嵌套属性</h3><p>设置和获取属性是通过 <code>BeanWrapper</code> 的 <code>setPropertyValue</code> 和 <code>getPropertyValue</code> 重载方法变体完成的。有关详细信息，请参见其 Javadoc。下表显示了这些约定的一些示例：</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>表示与 <code>getName()</code> 或 <code>isName()</code> 和 <code>setName(..)</code> 方法相对应的 <code>name</code> 属性 。</td>
</tr>
<tr>
<td>account.name</td>
<td>表示与 <code>getAccount().setName()</code> 或 <code>getAccount().getName()</code> 方法相对应的 <code>account</code> 属性的 <code>name</code> 嵌套属性。</td>
</tr>
<tr>
<td>account[2]</td>
<td>表示索引属性的<em>第三个</em>元素 <code>account</code>。索引属性可能是的 <code>array</code>，<code>list</code> 或其它天然有序集合。</td>
</tr>
<tr>
<td>account[COMPANYNAME]</td>
<td>表示<code>account</code> 这个 <code>Map</code>由 <code>COMPANYNAME</code> 键索引的条目的值。</td>
</tr>
</tbody></table>
<p>（如果您不打算直接使用 <code>BeanWrapper</code>，那么下一部分对您而言并不是至关重要的。如果仅使用 <code>DataBinder</code> 和 <code>BeanFactory</code> 及其默认实现，则应跳到 <code>PropertyEditors</code> 的部分。）</p>
<p>以下两个示例类使用 <code>BeanWrapper</code> 来获取和设置属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Company</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Employee managingDirector;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getManagingDirector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.managingDirector;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setManagingDirector</span><span class="params">(Employee managingDirector)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.managingDirector = managingDirector;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(<span class="keyword">float</span> salary)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下代码段显示了一些有关如何检索和操纵实例化的 <code>Companies</code> 和 <code>Employees</code> 的某些属性的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BeanWrapper company = <span class="keyword">new</span> BeanWrapperImpl(<span class="keyword">new</span> Company());</span><br><span class="line"><span class="comment">// setting the company name..</span></span><br><span class="line">company.setPropertyValue(<span class="string">"name"</span>, <span class="string">"Some Company Inc."</span>);</span><br><span class="line"><span class="comment">// ... can also be done like this:</span></span><br><span class="line">PropertyValue value = <span class="keyword">new</span> PropertyValue(<span class="string">"name"</span>, <span class="string">"Some Company Inc."</span>);</span><br><span class="line">company.setPropertyValue(value);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ok, let's create the director and tie it to the company:</span></span><br><span class="line">BeanWrapper jim = <span class="keyword">new</span> BeanWrapperImpl(<span class="keyword">new</span> Employee());</span><br><span class="line">jim.setPropertyValue(<span class="string">"name"</span>, <span class="string">"Jim Stravinsky"</span>);</span><br><span class="line">company.setPropertyValue(<span class="string">"managingDirector"</span>, jim.getWrappedInstance());</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieving the salary of the managingDirector through the company</span></span><br><span class="line">Float salary = (Float) company.getPropertyValue(<span class="string">"managingDirector.salary"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="内置的-PropertyEditor-实现"><a href="#内置的-PropertyEditor-实现" class="headerlink" title="内置的 PropertyEditor 实现"></a>内置的 <code>PropertyEditor</code> 实现</h3><p>pring 使用 <code>PropertyEditor</code> 的概念来实现对象和字符串之间的转换。以不同于对象本身的方式表示属性可能很方便。例如，日期可以用人类可读的方式表示（如字符串：”2007-14-09”），而我们仍然可以将人类可读的形式转换回原始日期（或者更好的是，转换任何日期以人类可读的形式输入到 <code>Date</code> 对象）。通过注册类型为 <code>java.beans.PropertyEditor</code> 的自定义编辑器，可以实现此行为。在 <code>BeanWrapper</code> 上或在特定的 IoC 容器中注册自定义编辑器（如上一章所述），使它具有如何将属性转换为所需类型的知识。有关 <code>PropertyEditor</code> 的更多信息，请参见 <a href="https://docs.oracle.com/javase/8/docs/api/java/beans/package-summary.html" target="_blank" rel="noopener">Oracle 的 java.beans 包的 javadoc</a>。</p>
<p>在 Spring 中使用属性编辑的两个示例：</p>
<ul>
<li>通过使用 <code>PropertyEditor</code> 实现在 bean 上设置属性。当使用 <code>String</code> 作为在 XML 文件中声明的某个 bean 的属性的值时，Spring（如果相应属性的设置器具有 <code>Class</code> 参数）将使用 <code>ClassEditor</code> 尝试将参数解析为 <code>Class</code> 对象。</li>
<li>在 Spring 的 MVC 框架中，通过使用各种 <code>PropertyEditor</code> 实现来解析 HTTP 请求参数，您可以在 <code>CommandController</code> 的所有子类中手动绑定这些实现。</li>
</ul>
<p>Spring 具有许多内置的 <code>PropertyEditor</code> 实现，以简化生活。它们都位于<code>org.springframework.beans.propertyeditors</code> 包中。默认情况下，大多数（但不是全部，如下表所示）由 <code>BeanWrapperImpl</code> 注册。如果可以通过某种方式配置属性编辑器，则仍可以注册自己的变体以覆盖默认变体。下表描述了 Spring 提供的各种 <code>PropertyEditor</code> 实现：</p>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ByteArrayPropertyEditor</code></td>
<td>字节数组的编辑器。将字符串转换为其相应的字节表示形式。默认情况下由 <code>BeanWrapperImpl</code> 注册。</td>
</tr>
<tr>
<td><code>ClassEditor</code></td>
<td>将代表类的字符串解析为实际类，反之亦然。当找不到类时，将抛出 <code>IllegalArgumentException</code>。默认情况下，由 <code>BeanWrapperImpl</code> 注册。</td>
</tr>
<tr>
<td><code>CustomBooleanEditor</code></td>
<td>布尔属性的可定制属性编辑器。默认情况下，由 <code>BeanWrapperImpl</code> 注册，但是可以通过将其自定义实例注册为自定义编辑器来覆盖。</td>
</tr>
<tr>
<td><code>CustomCollectionEditor</code></td>
<td>集合的属性编辑器，可将任何源 <code>Collection</code> 转换为给定的目标 <code>Collection</code> 类型。</td>
</tr>
<tr>
<td><code>CustomDateEditor</code></td>
<td><code>java.util.Date</code> 的可自定义属性编辑器，支持自定义 <code>DateFormat</code>。默认未注册。必须根据需要以适当的格式进行用户注册。</td>
</tr>
<tr>
<td><code>CustomNumberEditor</code></td>
<td>任何 <code>Number</code> 子类（例如 <code>Integer</code>，<code>Long</code>，<code>Float</code> 或 <code>Double</code>）的可自定义属性编辑器。默认情况下，由 <code>BeanWrapperImpl</code> 注册，但是可以通过将其自定义实例注册为自定义编辑器来覆盖。</td>
</tr>
<tr>
<td><code>FileEditor</code></td>
<td>将字符串解析为 <code>java.io.File</code> 对象。默认情况下，由 <code>BeanWrapperImpl</code> 注册。</td>
</tr>
<tr>
<td><code>InputStreamEditor</code></td>
<td>单向属性编辑器，它可以采用字符串并生成（通过中间的 <code>ResourceEditor</code> 和 <code>Resource</code>）一个 <code>InputStream</code>，以便可以将 <code>InputStream</code> 属性直接设置为字符串。请注意，默认用法不会为您关闭 <code>InputStream</code>。默认情况下，由 <code>BeanWrapperImpl</code> 注册。</td>
</tr>
<tr>
<td><code>LocaleEditor</code></td>
<td>可以将字符串解析为 <code>Locale</code> 对象，反之亦然（字符串格式为 _<code>[country]</code>_<code>[variant]</code>，与 Locale 的 <code>toString()</code> 方法相同）。默认情况下，由 <code>BeanWrapperImpl</code> 注册。</td>
</tr>
<tr>
<td><code>PatternEditor</code></td>
<td>可以将字符串解析为 <code>java.util.regex.Pattern</code> 对象，反之亦然。</td>
</tr>
<tr>
<td><code>PropertiesEditor</code></td>
<td>可以将字符串（以 <code>java.util.Properties</code> 类的 javadoc 中定义的格式格式化）转换为 <code>Properties</code> 对象。默认情况下，由 <code>BeanWrapperImpl</code> 注册。</td>
</tr>
<tr>
<td><code>StringTrimmerEditor</code></td>
<td>修剪字符串的属性编辑器。（可选）允许将空字符串转换为空值。默认情况下未注册——必须是用户注册的。</td>
</tr>
<tr>
<td><code>URLEditor</code></td>
<td>可以将 URL 的字符串表示形式解析为实际的 <code>URL</code> 对象。默认情况下，由 <code>BeanWrapperImpl</code> 注册</td>
</tr>
</tbody></table>
<p>Spring 使用 <code>java.beans.PropertyEditorManager</code> 设置可能需要的属性编辑器的搜索路径。搜索路径还包括 <code>sun.bean.editors</code>，其中包括针对诸如 <code>Font</code>，<code>Color</code> 和大多数基本类型的类型的 <code>PropertyEditor</code> 实现。 还要注意，如果标准 JavaBeans 基础结构与它们处理的类在同一包中，并且与该类具有相同的名称，并附加了 Editor，则标准 JavaBeans 基础结构将自动发现 <code>PropertyEditor</code> 类（无需显式注册它们）。例如，可能具有以下类和包结构，足以使 <code>SomethingEditor</code> 类被识别并用作 <code>Something</code> 类型的属性的 <code>PropertyEditor</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line">  chank</span><br><span class="line">    pop</span><br><span class="line">      Something</span><br><span class="line">      SomethingEditor // the PropertyEditor for the Something class</span><br></pre></td></tr></table></figure>

<p>注意，您也可以在此处使用标准的 <code>BeanInfo</code> JavaBeans 机制（在某种程度上进行了描述）。 以下示例使用 <code>BeanInfo</code> 机制使用关联类的属性显式注册一个或多个 <code>PropertyEditor</code> 实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line">  chank</span><br><span class="line">    pop</span><br><span class="line">      Something</span><br><span class="line">      SomethingBeanInfo // the BeanInfo for the Something class</span><br></pre></td></tr></table></figure>

<p>所引用的 <code>SomethingBeanInfo</code> 类的以下 Java 源代码将 <code>CustomNumberEditor</code> 与 <code>Something</code> 类的 <code>age</code> 属性相关联：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomethingBeanInfo</span> <span class="keyword">extends</span> <span class="title">SimpleBeanInfo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> PropertyDescriptor[] getPropertyDescriptors() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> PropertyEditor numberPE = <span class="keyword">new</span> CustomNumberEditor(Integer.class, <span class="keyword">true</span>);</span><br><span class="line">            PropertyDescriptor ageDescriptor = <span class="keyword">new</span> PropertyDescriptor(<span class="string">"age"</span>, Something.class) &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> PropertyEditor <span class="title">createPropertyEditor</span><span class="params">(Object bean)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> numberPE;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PropertyDescriptor[] &#123; ageDescriptor &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IntrospectionException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(ex.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册其他自定义-PropertyEditor-实现"><a href="#注册其他自定义-PropertyEditor-实现" class="headerlink" title="注册其他自定义 PropertyEditor 实现"></a>注册其他自定义 PropertyEditor 实现</h4><p>当将 bean 属性设置为字符串值时，Spring IoC 容器最终使用标准 JavaBeans <code>PropertyEditor</code> 实现将这些字符串转换为属性的复杂类型。Spring 预注册了许多自定义的 <code>PropertyEditor</code> 实现（例如，将表示为字符串的类名称转换为 <code>Class</code> 对象）。此外，Java 的标准 JavaBeans <code>PropertyEditor</code> 查找机制允许适当地命名类的 <code>PropertyEditor</code>，并将其与提供支持的类放在同一包中，以便可以自动找到它。</p>
<p>如果需要注册其他自定义 <code>PropertyEditor</code>，则可以使用几种机制。最手动的方法（通常不方便或不建议使用）是使用 <code>ConfigurableBeanFactory</code> 接口的 <code>registerCustomEditor()</code> 方法，并假设您有 <code>BeanFactory</code> 引用。另一种（稍微方便些）的机制是使用一种称为 <code>CustomEditorConfigurer</code> 的特殊 bean 工厂后处理器。尽管您可以将 Bean 工厂后处理器与 BeanFactory 实现一起使用，但 <code>CustomEditorConfigurer</code> 具有嵌套的属性设置，因此我们强烈建议您将其与 <code>ApplicationContext</code> 一起使用，在这里可以将其以与其他任何 Bean 相似的方式进行部署，并且可以在任何位置进行部署。自动检测并应用。</p>
<p>请注意，所有的 bean 工厂和应用程序上下文通过使用 BeanWrapper 来处理属性转换，都会自动使用许多内置的属性编辑器。上一节列出了 BeanWrapper 注册的标准属性编辑器。此外，<code>ApplicationContext</code> 还以适合特定应用程序上下文类型的方式重写或添加其他编辑器，以处理资源查找。</p>
<p>标准 JavaBeans <code>PropertyEditor</code> 实例用于将以字符串表示的属性值转换为该属性的实际复杂类型。您可以使用 bean 工厂的后处理器 <code>CustomEditorConfigurer</code> 来方便地将对其他 <code>PropertyEditor</code> 实例的支持添加到 <code>ApplicationContext</code>。</p>
<p>考虑以下示例，该示例定义了一个名为 <code>ExoticType</code> 的用户类和另一个名为 <code>DependsOnExoticType</code> 的类，该类需要将 <code>ExoticType</code> 设置为属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExoticType</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExoticType</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependsOnExoticType</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ExoticType type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(ExoticType type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正确设置之后，我们希望能够将 type 属性分配为字符串，<code>PropertyEditor</code> 会将其转换为实际的 <code>ExoticType</code> 实例。 以下 bean 定义显示了如何建立这种关系：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sample"</span> <span class="attr">class</span>=<span class="string">"example.DependsOnExoticType"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"type"</span> <span class="attr">value</span>=<span class="string">"aNameForExoticType"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>PropertyEditor</code> 实现可能类似于以下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// converts string representation to ExoticType object</span></span><br><span class="line"><span class="keyword">package</span> example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExoticTypeEditor</span> <span class="keyword">extends</span> <span class="title">PropertyEditorSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAsText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        setValue(<span class="keyword">new</span> ExoticType(text.toUpperCase()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring-类型转换"><a href="#Spring-类型转换" class="headerlink" title="Spring 类型转换"></a>Spring 类型转换</h2><p>Spring 3 引入了 <code>core.convert</code> 包，该包提供了通用的类型转换系统。系统定义了一个用于实现类型转换逻辑的 SPI 和一个用于在运行时执行类型转换的 API。在 Spring 容器中，可以使用此系统作为 <code>PropertyEditor</code> 实现的替代方法，以将外部化的 bean 属性值字符串转换为所需的属性类型。 您还可以在应用程序中需要类型转换的任何地方使用公共 API。</p>
<h3 id="转换器-SPI"><a href="#转换器-SPI" class="headerlink" title="转换器 SPI"></a>转换器 SPI</h3><p>如以下接口定义所示，用于实现类型转换逻辑的 SPI 非常简单且具有强类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">S</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">convert</span><span class="params">(S source)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要创建自己的转换器，请实现 Converter 接口并将 S 设置为要转换的类型，并将 T 设置为要转换的类型。如果还需要注册一个委托数组或集合转换器（默认情况下 DefaultConversionService 会这样做），则也可以透明地应用此类转换器，如果需要将 S 的集合或数组转换为 T 的数组或集合。</p>
<p>对于每次对 convert（S）的调用，保证源参数不为 null。如果转换失败，您的转换器可能会引发任何未经检查的异常。具体来说，它应该抛出 IllegalArgumentException 以报告无效的源值。注意确保您的 Converter 实现是线程安全的。</p>
<p>为了方便起见，在 core.convert.support 软件包中提供了几种转换器实现。这些包括从字符串到数字和其他常见类型的转换器。下面的清单显示了 StringToInteger 类，它是一个典型的 Converter 实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToInteger</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-ConverterFactory"><a href="#使用-ConverterFactory" class="headerlink" title="使用 ConverterFactory"></a>使用 <code>ConverterFactory</code></h3><p>当需要集中整个类层次结构的转换逻辑时（例如，从 String 转换为 Enum 对象时），可以实现 ConverterFactory，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConverterFactory</span>&lt;<span class="title">S</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    &lt;T extends R&gt; <span class="function">Converter&lt;S, T&gt; <span class="title">getConverter</span><span class="params">(Class&lt;T&gt; targetType)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参数化 S 为您要转换的类型，参数化 R 为基类型，定义可以转换为的类的范围。 然后实现 getConverter（Class <t>），其中 T 是 R 的子类。</t></p>
<p>以 StringToEnumConverterFactory 为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToEnumConverterFactory</span> <span class="keyword">implements</span> <span class="title">ConverterFactory</span>&lt;<span class="title">String</span>, <span class="title">Enum</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T extends Enum&gt; <span class="function">Converter&lt;String, T&gt; <span class="title">getConverter</span><span class="params">(Class&lt;T&gt; targetType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringToEnumConverter(targetType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToEnumConverter</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Enum</span>&gt; <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Class&lt;T&gt; enumType;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StringToEnumConverter</span><span class="params">(Class&lt;T&gt; enumType)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.enumType = enumType;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (T) Enum.valueOf(<span class="keyword">this</span>.enumType, source.trim());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-GenericConverter"><a href="#使用-GenericConverter" class="headerlink" title="使用 GenericConverter"></a>使用 <code>GenericConverter</code></h3><p>当您需要复杂的 <code>Converter</code> 实现时，请考虑使用 <code>GenericConverter</code> 接口。 与 <code>Converter</code> 相比，<code>GenericConverter</code> 具有比 <code>Converter</code> 更灵活但强度不高的签名，支持在多种源类型和目标类型之间进行转换。此外，<code>GenericConverter</code> 使您可以在实现转换逻辑时使用可用的源字段和目标字段上下文。 这种上下文允许类型转换由字段注释或在字段签名上声明的通用信息驱动。 以下清单显示了 <code>GenericConverter</code> 的接口定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GenericConverter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;ConvertiblePair&gt; <span class="title">getConvertibleTypes</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">convert</span><span class="params">(Object source, TypeDescriptor sourceType, TypeDescriptor targetType)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要实现 <code>GenericConverter</code>，请让 <code>getConvertibleTypes()</code> 返回支持的源 → 目标类型对。 然后实现 <code>convert(Object，TypeDescriptor，TypeDescriptor)</code> 包含您的转换逻辑。 源 <code>TypeDescriptor</code> 提供对包含正在转换的值的源字段的访问。 使用目标 <code>TypeDescriptor</code>，可以访问要设置转换值的目标字段。</p>
<p><code>GenericConverter</code> 的一个很好的例子是在 Java 数组和集合之间进行转换的转换器。 这样的 <code>ArrayToCollectionConverter</code> 会对声明目标集合类型的字段进行内省，以解析集合的元素类型。 这样就可以在将集合设置到目标字段上之前，将源数组中的每个元素转换为集合元素类型。</p>
<blockquote>
<p>由于 <code>GenericConverter</code> 是一个更复杂的 SPI 接口，因此仅应在需要时使用它。 支持 <code>Converter</code> 或 <code>ConverterFactory</code> 以满足基本的类型转换需求。</p>
</blockquote>
<h4 id="使用-ConditionalGenericConverter"><a href="#使用-ConditionalGenericConverter" class="headerlink" title="使用 ConditionalGenericConverter"></a>使用 <code>ConditionalGenericConverter</code></h4><p>有时，您希望 Converter 仅在满足特定条件时才运行。 例如，您可能只想在目标字段上存在特定注释时才运行 Converter，或者可能仅在目标类上定义了特定方法（例如静态 valueOf 方法）时才运行 Converter。 ConditionalGenericConverter 是 GenericConverter 和 ConditionalConverter 接口的联合，可让您定义以下自定义匹配条件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConditionalConverter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(TypeDescriptor sourceType, TypeDescriptor targetType)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConditionalGenericConverter</span> <span class="keyword">extends</span> <span class="title">GenericConverter</span>, <span class="title">ConditionalConverter</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ConditionalGenericConverter</code> 的一个很好的例子是 <code>EntityConverter</code>，它在持久实体标识符和实体引用之间进行转换。仅当目标实体类型声明静态查找器方法（例如 <code>findAccount(Long)</code>）时，此类 <code>EntityConverter</code> 才可能匹配。 您可以在 <code>matchs(TypeDescriptor，TypeDescriptor)</code> 的实现中执行这种 finder 方法检查。</p>
<h3 id="ConversionService-API"><a href="#ConversionService-API" class="headerlink" title="ConversionService API"></a><code>ConversionService</code> API</h3><p><code>ConversionService</code> 定义了一个统一的 API，用于在运行时执行类型转换逻辑。转换器通常在以下外观接口后面执行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.core.convert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConversionService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">canConvert</span><span class="params">(Class&lt;?&gt; sourceType, Class&lt;?&gt; targetType)</span></span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">convert</span><span class="params">(Object source, Class&lt;T&gt; targetType)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">canConvert</span><span class="params">(TypeDescriptor sourceType, TypeDescriptor targetType)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">convert</span><span class="params">(Object source, TypeDescriptor sourceType, TypeDescriptor targetType)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大多数 <code>ConversionService</code> 实现也都实现 <code>ConverterRegistry</code>，该转换器提供用于注册转换器的 SPI。在内部，<code>ConversionService</code> 实现委派其注册的转换器执行类型转换逻辑。</p>
<p><code>core.convert.support</code> 软件包中提供了一个强大的 <code>ConversionService</code> 实现。 <code>GenericConversionService</code> 是适用于大多数环境的通用实现。<code>ConversionServiceFactory</code> 提供了一个方便的工厂来创建通用的 <code>ConversionService</code> 配置。</p>
<h3 id="注册一个-ConversionService"><a href="#注册一个-ConversionService" class="headerlink" title="注册一个 ConversionService"></a>注册一个 <code>ConversionService</code></h3><p><code>ConversionService</code> 是无状态对象，旨在在应用程序启动时实例化，然后在多个线程之间共享。在 Spring 应用程序中，通常为每个 Spring 容器（或 <code>ApplicationContext</code>）配置一个 <code>ConversionService</code> 实例。当框架需要执行类型转换时，Spring 会调用该 <code>ConversionService</code> 并使用它。 您还可以将此 <code>ConversionService</code> 注入到任何 bean 中，然后直接调用它。</p>
<blockquote>
<p>如果未向 Spring 注册任何 <code>ConversionService</code>，则使用原始的基于 <code>PropertyEditor</code> 的系统。</p>
</blockquote>
<p>要向 Spring 注册默认的 <code>ConversionService</code>，请添加以下 bean 定义，其 id 为 <code>conversionService</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ConversionServiceFactoryBean"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>默认的 <code>ConversionService</code> 可以在字符串，数字，枚举，集合，映射和其他常见类型之间进行转换。 要用您自己的自定义转换器补充或覆盖默认转换器，请设置 <code>converters</code> 属性。 属性值可以实现 <code>Converter</code>，<code>ConverterFactory</code> 或 <code>GenericConverter</code> 接口中的任何一个。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"conversionService"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"example.MyCustomConverter"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 Spring MVC 应用程序中使用 <code>ConversionService</code> 也很常见。 参见 Spring MVC 一章中的转换和格式化。</p>
<p>在某些情况下，您可能希望在转换过程中应用格式设置。 有关使用 <code>FormattingConversionServiceFactoryBean</code> 的详细信息，请参见 <code>FormatterRegistry</code> SPI。</p>
<h3 id="使用-ConversionService-编码"><a href="#使用-ConversionService-编码" class="headerlink" title="使用 ConversionService 编码"></a>使用 ConversionService 编码</h3><p>要以编程方式使用 ConversionService 实例，可以像对其他任何 bean 一样注入对该实例的引用。 以下示例显示了如何执行此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">(ConversionService conversionService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.conversionService = conversionService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doIt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.conversionService.convert(...)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于大多数用例，可以使用指定 targetType 的 convert 方法，但不适用于更复杂的类型，例如参数化元素的集合。 例如，如果要以编程方式将整数列表转换为字符串列表，则需要提供源类型和目标类型的正式定义。</p>
<p>幸运的是，如下面的示例所示，TypeDescriptor 提供了各种选项来使操作变得简单明了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DefaultConversionService cs = <span class="keyword">new</span> DefaultConversionService();</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; input = ...</span><br><span class="line">cs.convert(input,</span><br><span class="line">    TypeDescriptor.forObject(input), <span class="comment">// List&lt;Integer&gt; type descriptor</span></span><br><span class="line">    TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(String.class)));</span><br></pre></td></tr></table></figure>

<p>请注意，<code>DefaultConversionService</code> 自动注册适用于大多数环境的转换器。 这包括集合转换器，标量转换器和基本的对象到字符串转换器。 您可以使用 <code>DefaultConversionService</code> 类上的静态 <code>addDefaultConverters</code> 方法向任何 <code>ConverterRegistry</code> 注册相同的转换器。</p>
<p>值类型的转换器可重用于数组和集合，因此，假设标准的集合处理适当，则无需创建特定的转换器即可将 S 的集合转换为 T 的集合。</p>
<h2 id="Spring-字段格式"><a href="#Spring-字段格式" class="headerlink" title="Spring 字段格式"></a>Spring 字段格式</h2><p>如上一节所述，<code>core.convert</code> 是一种通用类型转换系统。它提供了统一的 <code>ConversionService</code> API 和强类型的 <code>Converter</code> SPI，用于实现从一种类型到另一种类型的转换逻辑。 Spring 容器使用此系统绑定 bean 属性值。此外，Spring Expression Language（SpEL）和 <code>DataBinder</code> 都使用此系统绑定字段值。例如，当 SpEL 需要强制将 <code>Short</code> 转换为 <code>Long</code> 来完成 <code>expression.setValue(Object bean, Object value)</code> 尝试时，<code>core.convert</code> 系统将执行强制转换。</p>
<p>现在考虑典型客户端环境（例如 Web 或桌面应用程序）的类型转换要求。在这样的环境中，您通常会从 <code>String</code> 转换为支持客户端回发过程，然后又转换为 <code>String</code> 以支持视图渲染过程。另外，您通常需要本地化 <code>String</code> 值。更通用的 <code>core.convert</code> <code>Converter</code> SPI 不能直接满足此类格式化要求。为了直接解决这些问题，Spring 3 引入了方便的 <code>Formatter</code> SPI，它为客户端环境提供了 <code>PropertyEditor</code> 实现的简单而强大的替代方案。</p>
<p>通常，当您需要实现通用类型转换逻辑时（例如，用于在 <code>java.util.Date</code> 和 <code>Long</code> 之间进行转换），可以使用 <code>Converter</code> SPI。在客户端环境（例如 Web 应用程序）中工作并且需要解析和打印本地化的字段值时，可以使用 <code>Formatter</code> SPI。 <code>ConversionService</code> 为两个 SPI 提供统一的类型转换 API。</p>
<h3 id="Formatter-SPI"><a href="#Formatter-SPI" class="headerlink" title="Formatter SPI"></a>Formatter SPI</h3><p>用于实现字段格式化逻辑的 <code>Formatter</code> SPI 非常简单且类型严格。 以下清单显示了 <code>Formatter</code> 接口定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Formatter</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Printer</span>&lt;<span class="title">T</span>&gt;, <span class="title">Parser</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Formatter</code> 从 <code>Printer</code> 和 <code>Parser</code> 构建块接口扩展。 以下清单显示了这两个接口的定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Printer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">print</span><span class="params">(T fieldValue, Locale locale)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Parser</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">parse</span><span class="params">(String clientValue, Locale locale)</span> <span class="keyword">throws</span> ParseException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要创建自己的 <code>Formatter</code>，请实现前面显示的 <code>Formatter</code> 接口。将 T 参数化为您希望格式化的对象的类型（例如 <code>java.util.Date</code>）。实现 <code>print()</code> 操作以打印 T 的实例以在客户端语言环境中显示。实现 <code>parse()</code> 操作，以从客户端语言环境返回的格式化表示形式解析 T 的实例。如果解析尝试失败，则 <code>Formatter</code> 应该抛出 <code>ParseException</code> 或 <code>IllegalArgumentException</code>。注意确保您的 <code>Formatter</code> 实现是线程安全的。</p>
<p><code>format</code> 子包为方便起见提供了几种 <code>Formatter</code> 实现。数字程序包提供 <code>NumberStyleFormatter``，CurrencyStyleFormatter</code> 和 <code>PercentStyleFormatter</code> 来格式化使用 <code>java.text.NumberFormat</code> 的 <code>Number</code> 对象。<code>datetime</code> 包提供了一个 <code>DateFormatter</code>，用于使用 <code>java.text.DateFormat</code> 格式化 <code>java.util.Date</code> 对象。<code>datetime.joda</code> 包基于 Joda-Time 库提供了全面的日期时间格式支持。</p>
<p>以下 <code>DateFormatter</code> 是 <code>Formatter</code> 实现的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format.datetime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DateFormatter</span> <span class="keyword">implements</span> <span class="title">Formatter</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String pattern;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DateFormatter</span><span class="params">(String pattern)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pattern = pattern;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">print</span><span class="params">(Date date, Locale locale)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (date == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getDateFormat(locale).format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">parse</span><span class="params">(String formatted, Locale locale)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (formatted.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getDateFormat(locale).parse(formatted);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> DateFormat <span class="title">getDateFormat</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line">        DateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="keyword">this</span>.pattern, locale);</span><br><span class="line">        dateFormat.setLenient(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> dateFormat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 团队欢迎社区推动的 <code>Formatter</code> 贡献。 请参阅 GitHub 问题以做出贡献。</p>
<h3 id="注释驱动的格式"><a href="#注释驱动的格式" class="headerlink" title="注释驱动的格式"></a>注释驱动的格式</h3><p>可以通过字段类型或注释配置字段格式。要将注释绑定到 <code>Formatter</code>，请实现 <code>AnnotationFormatterFactory</code>。以下显示了<code>AnnotationFormatterFactory</code> 接口的定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotationFormatterFactory</span>&lt;<span class="title">A</span> <span class="keyword">extends</span> <span class="title">Annotation</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    Set&lt;Class&lt;?&gt;&gt; getFieldTypes();</span><br><span class="line"></span><br><span class="line">    Printer&lt;?&gt; getPrinter(A annotation, Class&lt;?&gt; fieldType);</span><br><span class="line"></span><br><span class="line">    Parser&lt;?&gt; getParser(A annotation, Class&lt;?&gt; fieldType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要创建一个实现：将 A 参数化为要与格式逻辑关联的字段注解类型，例如 <code>org.springframework.format.annotation.DateTimeFormat</code>。让 <code>getFieldTypes()</code> 返回可在其上使用注释的字段类型。让 <code>getPrinter()</code> 返回 <code>Printer</code> 以打印带注释的字段的值。让 <code>getParser()</code> 返回解析器以解析带注释字段的 <code>clientValue</code>。</p>
<p>以下示例 <code>AnnotationFormatterFactory</code> 实现将 <code>@NumberFormat</code> 批注绑定到格式化程序，以指定数字样式或模式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NumberFormatAnnotationFormatterFactory</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">AnnotationFormatterFactory</span>&lt;<span class="title">NumberFormat</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Class&lt;?&gt;&gt; getFieldTypes() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;Class&lt;?&gt;&gt;(asList(<span class="keyword">new</span> Class&lt;?&gt;[] &#123;</span><br><span class="line">            Short.class, Integer.class, Long.class, Float.class,</span><br><span class="line">            Double.class, BigDecimal.class, BigInteger.class &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Printer&lt;Number&gt; <span class="title">getPrinter</span><span class="params">(NumberFormat annotation, Class&lt;?&gt; fieldType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configureFormatterFrom(annotation, fieldType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Parser&lt;Number&gt; <span class="title">getParser</span><span class="params">(NumberFormat annotation, Class&lt;?&gt; fieldType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configureFormatterFrom(annotation, fieldType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Formatter&lt;Number&gt; <span class="title">configureFormatterFrom</span><span class="params">(NumberFormat annotation, Class&lt;?&gt; fieldType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!annotation.pattern().isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> NumberStyleFormatter(annotation.pattern());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Style style = annotation.style();</span><br><span class="line">            <span class="keyword">if</span> (style == Style.PERCENT) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> PercentStyleFormatter();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (style == Style.CURRENCY) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> CurrencyStyleFormatter();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> NumberStyleFormatter();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要触发格式，可以使用 <code>@NumberFormat</code> 注释字段，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NumberFormat</span>(style=Style.CURRENCY)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal decimal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="格式注释-API"><a href="#格式注释-API" class="headerlink" title="格式注释 API"></a>格式注释 API</h4><p><code>org.springframework.format.annotation</code> 包中存在一个可移植的格式注释 API。 您可以使用 <code>@NumberFormat</code> 格式化数字字段（例如 Double 和 Long），并使用 <code>@DateTimeFormat</code> 格式化 <code>java.util.Date</code>，<code>java.util.Calendar</code>，<code>Long</code>（用于毫秒时间戳）以及 JSR-310 <code>java.time</code> 和 Joda-Time 值类型。</p>
<p>以下示例使用 <code>@DateTimeFormat</code> 将 <code>java.util.Date</code> 格式化为 ISO 日期（yyyy-MM-dd）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(iso=ISO.DATE)</span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FormatterRegistry-SPI"><a href="#FormatterRegistry-SPI" class="headerlink" title="FormatterRegistry SPI"></a><code>FormatterRegistry</code> SPI</h3><p><code>FormatterRegistry</code> 是用于注册格式器和转换器的 SPI。<code>FormattingConversionService</code> 是适用于大多数环境的 <code>FormatterRegistry</code> 的实现。 您可以通过编程方式或声明方式将此变体配置为 Spring Bean，例如通过使用 <code>FormattingConversionServiceFactoryBean</code>。 由于此实现还实现了 <code>ConversionService</code>，因此您可以直接将其配置为与 Spring 的 <code>DataBinder</code> 和 Spring 表达式语言（SpEL）一起使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FormatterRegistry</span> <span class="keyword">extends</span> <span class="title">ConverterRegistry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addFormatterForFieldType</span><span class="params">(Class&lt;?&gt; fieldType, Printer&lt;?&gt; printer, Parser&lt;?&gt; parser)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addFormatterForFieldType</span><span class="params">(Class&lt;?&gt; fieldType, Formatter&lt;?&gt; formatter)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addFormatterForFieldType</span><span class="params">(Formatter&lt;?&gt; formatter)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addFormatterForAnnotation</span><span class="params">(AnnotationFormatterFactory&lt;?&gt; factory)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如前面的清单所示，您可以按字段类型或批注注册格式化程序。</p>
<p><code>FormatterRegistry</code> SPI 使您可以集中配置格式设置规则，而不必在控制器之间复制此类配置。 例如，您可能要强制所有日期字段以某种方式设置格式或带有特定注释的字段以某种方式设置格式。 使用共享的 <code>FormatterRegistry</code>，您可以一次定义这些规则，并在需要格式化时应用它们。</p>
<h3 id="FormatterRegistrar-SPI"><a href="#FormatterRegistrar-SPI" class="headerlink" title="FormatterRegistrar SPI"></a><code>FormatterRegistrar</code> SPI</h3><p><code>FormatterRegistrar</code> 是一个 SPI，用于通过 <code>FormatterRegistry</code> 注册格式器和转换器。 以下清单显示了其接口定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FormatterRegistrar</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">registerFormatters</span><span class="params">(FormatterRegistry registry)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为给定的格式类别（例如日期格式）注册多个相关的转换器和格式器时，<code>FormatterRegistrar</code> 很有用。 在声明式注册不足的情况下（例如，当格式化程序需要在不同于其自身 <code>&lt;T&gt;</code> 的特定字段类型下建立索引或注册 <code>Printer</code>/<code>Parser</code> 对时），它也很有用。 下一节将提供有关转换器和格式化程序注册的更多信息。</p>
<h3 id="在-Spring-MVC-中配置格式"><a href="#在-Spring-MVC-中配置格式" class="headerlink" title="在 Spring MVC 中配置格式"></a>在 Spring MVC 中配置格式</h3><p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-conversion" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config-conversion</a></p>
<h3 id="配置全局日期和时间格式"><a href="#配置全局日期和时间格式" class="headerlink" title="配置全局日期和时间格式"></a>配置全局日期和时间格式</h3><p>默认情况下，未使用 <code>@DateTimeFormat</code> 注释的日期和时间字段是使用 <code>DateFormat.SHORT</code> 样式从字符串转换的。 如果愿意，可以通过定义自己的全局格式来更改此设置。</p>
<p>为此，请确保 Spring 不注册默认格式器。 相反，可以借助以下方法手动注册格式化程序：</p>
<ul>
<li><code>org.springframework.format.datetime.standard.DateTimeFormatterRegistrar</code></li>
<li><code>org.springframework.format.datetime.DateFormatterRegistrar</code> 或 joda-Time 的 <code>org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar</code>。</li>
</ul>
<p>例如，以下 Java 配置注册全局 yyyyMMdd 格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FormattingConversionService <span class="title">conversionService</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use the DefaultFormattingConversionService but do not register defaults</span></span><br><span class="line">        DefaultFormattingConversionService conversionService = <span class="keyword">new</span> DefaultFormattingConversionService(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Ensure @NumberFormat is still supported</span></span><br><span class="line">        conversionService.addFormatterForFieldAnnotation(<span class="keyword">new</span> NumberFormatAnnotationFormatterFactory());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register JSR-310 date conversion with a specific global format</span></span><br><span class="line">        DateTimeFormatterRegistrar registrar = <span class="keyword">new</span> DateTimeFormatterRegistrar();</span><br><span class="line">        registrar.setDateFormatter(DateTimeFormatter.ofPattern(<span class="string">"yyyyMMdd"</span>));</span><br><span class="line">        registrar.registerFormatters(conversionService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Register date conversion with a specific global format</span></span><br><span class="line">        DateFormatterRegistrar registrar = <span class="keyword">new</span> DateFormatterRegistrar();</span><br><span class="line">        registrar.setFormatter(<span class="keyword">new</span> DateFormatter(<span class="string">"yyyyMMdd"</span>));</span><br><span class="line">        registrar.registerFormatters(conversionService);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> conversionService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您喜欢基于 XML 的配置，则可以使用 FormattingConversionServiceFactoryBean。 以下示例显示了如何执行此操作（这次使用 Joda Time）:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">    &lt;bean id="</span><span class="attr">conversionService</span>" <span class="attr">class</span>=<span class="string">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"registerDefaultFormatters"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"formatters"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.format.number.NumberFormatAnnotationFormatterFactory"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"formatterRegistrars"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dateFormatter"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.format.datetime.joda.DateTimeFormatterFactoryBean"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pattern"</span> <span class="attr">value</span>=<span class="string">"yyyyMMdd"</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>请注意，在 Web 应用程序中配置日期和时间格式时，还有其他注意事项。请参阅 <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/web.html#mvc-config-conversion" target="_blank" rel="noopener">WebMVC 转换和格式</a>或 <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/web-reactive.html#webflux-config-conversion" target="_blank" rel="noopener">WebFlux 转换和格式</a>。</p>
<h2 id="Java-Bean-验证"><a href="#Java-Bean-验证" class="headerlink" title="Java Bean 验证"></a>Java Bean 验证</h2><p>Spring 框架提供了对 <a href="https://beanvalidation.org/" target="_blank" rel="noopener">Java Bean 验证</a> API 的支持。</p>
<h3 id="Bean-验证概述"><a href="#Bean-验证概述" class="headerlink" title="Bean 验证概述"></a>Bean 验证概述</h3><p>Bean 验证为 Java 应用程序提供了通过约束声明和元数据进行验证的通用方法。要使用它，您需要使用声明性验证约束对域模型属性进行注释，然后由运行时强制实施。有内置的约束，您也可以定义自己的自定义约束。</p>
<p>考虑以下示例，该示例显示了具有两个属性的简单 <code>PersonForm</code> 模型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonForm</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bean 验证使您可以声明约束，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonForm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size</span>(max=<span class="number">64</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Min</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，Bean 验证验证器根据声明的约束来验证此类的实例。 有关该 API 的一般信息，请参见 <a href="https://beanvalidation.org/" target="_blank" rel="noopener">Bean 验证</a>。 有关特定限制，请参见 <a href="https://hibernate.org/validator/" target="_blank" rel="noopener">Hibernate Validator 文档</a>。 要学习如何将 bean 验证提供程序设置为 Spring bean，请继续阅读。</p>
<h3 id="配置-Bean-验证提供程序"><a href="#配置-Bean-验证提供程序" class="headerlink" title="配置 Bean 验证提供程序"></a>配置 Bean 验证提供程序</h3><p>Spring 提供了对 Bean 验证 API 的全面支持，包括将 Bean 验证提供程序作为 Spring Bean 进行引导。 这使您可以在应用程序中需要验证的任何地方注入 <code>javax.validation.ValidatorFactory</code> 或 <code>javax.validation.Validator</code>。</p>
<p>您可以使用 <code>LocalValidatorFactoryBean</code> 将默认的 <code>Validator</code> 配置为 Spring Bean，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.validation.beanvalidation.LocalValidatorFactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalValidatorFactoryBean <span class="title">validator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LocalValidatorFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面示例中的基本配置触发 Bean 验证以使用其默认引导机制进行初始化。 Bean 验证提供程序，例如 Hibernate Validator，应该存在于类路径中并被自动检测到。</p>
<h4 id="注入验证器"><a href="#注入验证器" class="headerlink" title="注入验证器"></a>注入验证器</h4><p><code>LocalValidatorFactoryBean</code> 同时实现 <code>javax.validation.ValidatorFactory</code> 和 <code>javax.validation.Validator</code> 以及 Spring 的 <code>org.springframework.validation.Validator</code>。 您可以将对这些接口之一的引用注入需要调用验证逻辑的 bean 中。</p>
<p>如果您希望直接使用 Bean Validation API，则可以注入对 <code>javax.validation.Validator</code> 的引用，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.Validator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Validator validator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果您的 bean 需要使用 Spring Validation API，则可以注入对 <code>org.springframework.validation.Validator</code> 的引用，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.validation.Validator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Validator validator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置自定义约束"><a href="#配置自定义约束" class="headerlink" title="配置自定义约束"></a>配置自定义约束</h4><p>每个 bean 验证约束都包括两个部分：</p>
<p><code>@Constraint</code> 批注，用于声明约束及其可配置属性。</p>
<p><code>javax.validation.ConstraintValidator</code> 接口的实现，用于实现约束的行为。</p>
<p>要将声明与实现相关联，每个 <code>@Constraint</code> 批注都引用一个对应的 <code>ConstraintValidator</code> 实现类。 在运行时，当在域模型中遇到约束注释时，<code>ConstraintValidatorFactory</code>实例化引用的实现。</p>
<p>默认情况下，<code>LocalValidatorFactoryBean</code> 配置一个 <code>SpringConstraintValidatorFactory</code>，该工厂使用 Spring 创建 <code>ConstraintValidator</code> 实例。 这使您的自定义 <code>ConstraintValidators</code> 像其他任何 Spring bean 一样受益于依赖项注入。</p>
<p>以下示例显示了一个自定义 <code>@Constraint</code> 声明，后跟一个关联的 <code>ConstraintValidator</code> 实现，该实现使用 Spring 进行依赖项注入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD, ElementType.FIELD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy=MyConstraintValidator.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyConstraint &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConstraintValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span>;</span><br><span class="line">    <span class="keyword">private</span> Foo aDependency;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如前面的示例所示，<code>ConstraintValidator</code> 实现可以像其他任何 Spring bean 一样具有其 <code>@Autowired</code> 依赖项。</p>
<h4 id="Spring-驱动方法验证"><a href="#Spring-驱动方法验证" class="headerlink" title="Spring 驱动方法验证"></a>Spring 驱动方法验证</h4><p>您可以通过 <code>MethodValidationPostProcessor</code> bean 定义将 Bean Validation 1.1（以及作为自定义扩展，还包括 Hibernate Validator 4.3）支持的方法验证功能集成到 Spring 上下文中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.validation.beanvalidation.MethodValidationPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MethodValidationPostProcessor <span class="title">validationPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MethodValidationPostProcessor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了有资格进行 Spring 驱动的方法验证，所有目标类都必须使用 Spring 的 <code>@Validated</code> 注释进行注释，该注释也可以选择声明要使用的验证组。 有关使用 Hibernate Validator 和 Bean Validation 1.1 提供程序的设置详细信息，请参见 <a href="https://docs.spring.io/spring-framework/docs/5.3.0-SNAPSHOT/javadoc-api/org/springframework/validation/beanvalidation/MethodValidationPostProcessor.html" target="_blank" rel="noopener"><code>MethodValidationPostProcessor</code></a>。</p>
<blockquote>
<p>方法验证依赖于目标类周围的 AOP 代理，即接口上方法的 JDK 动态代理或 CGLIB 代理。 代理的使用存在某些限制，<a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#aop-understanding-aop-proxies" target="_blank" rel="noopener">《了解 AOP 代理》</a> 中介绍了其中的一些限制。 另外，请记住在代理类上始终使用方法和访问器；直接现场字段将不起作用。</p>
</blockquote>
<h4 id="其他配置选项"><a href="#其他配置选项" class="headerlink" title="其他配置选项"></a>其他配置选项</h4><p>在大多数情况下，默认 <code>LocalValidatorFactoryBean</code> 配置就足够了。 从消息插值到遍历解析，有许多用于各种 Bean 验证构造的配置选项。 有关这些选项的更多信息，请参见 <a href="https://docs.spring.io/spring-framework/docs/5.3.0-SNAPSHOT/javadoc-api/org/springframework/validation/beanvalidation/LocalValidatorFactoryBean.html" target="_blank" rel="noopener"><code>LocalValidatorFactoryBean</code> Javadoc</a>。</p>
<h3 id="注册一个-DataBinder"><a href="#注册一个-DataBinder" class="headerlink" title="注册一个 DataBinder"></a>注册一个 <code>DataBinder</code></h3><p>从 Spring 3 开始，您可以使用 Validator 配置 <code>DataBinder</code> 实例。 配置完成后，您可以通过调用 <code>binder.validate()</code> 来调用 <code>Validator</code>。任何验证 <code>Errors</code> 都会自动添加到活页夹的 <code>BindingResult</code> 中。</p>
<p>下面的示例演示如何在绑定到目标对象后，以编程方式使用 <code>DataBinder</code> 来调用验证逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Foo target = <span class="keyword">new</span> Foo();</span><br><span class="line">DataBinder binder = <span class="keyword">new</span> DataBinder(target);</span><br><span class="line">binder.setValidator(<span class="keyword">new</span> FooValidator());</span><br><span class="line"></span><br><span class="line"><span class="comment">// bind to the target object</span></span><br><span class="line">binder.bind(propertyValues);</span><br><span class="line"></span><br><span class="line"><span class="comment">// validate the target object</span></span><br><span class="line">binder.validate();</span><br><span class="line"></span><br><span class="line"><span class="comment">// get BindingResult that includes any validation errors</span></span><br><span class="line">BindingResult results = binder.getBindingResult();</span><br></pre></td></tr></table></figure>

<p>您还可以通过 <code>dataBinder.addValidators</code> 和 <code>dataBinder.replaceValidators</code> 配置具有多个 <code>Validator</code> 实例的 <code>DataBinder</code>。当将全局配置的 bean 验证与在 <code>DataBinder</code> 实例上本地配置的 Spring Validator 结合使用时，这很有用。 请参阅 <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/web.html#mvc-config-validation" target="_blank" rel="noopener">Spring MVC 验证配置</a>。</p>
<h3 id="Spring-MVC-3-Validation"><a href="#Spring-MVC-3-Validation" class="headerlink" title="Spring MVC 3 Validation"></a>Spring MVC 3 Validation</h3><p>参见 <a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/web.html#mvc-config-validation" target="_blank" rel="noopener">Spring MVC 中的验证</a>。</p>

      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/阅读/" rel="tag">#阅读</a>
          
            <a href="/tags/Spring/" rel="tag">#Spring</a>
          
            <a href="/tags/Java/" rel="tag">#Java</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/spring-3/" rel="next" title="Spring进阶 - 资源">
                <i class="fa fa-chevron-left"></i> Spring进阶 - 资源
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/spring-5/" rel="prev" title="Spring进阶 - spring 表达式语言（SpEL）">
                Spring进阶 - spring 表达式语言（SpEL） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2020/05/spring-4/" data-title="Spring进阶 - 验证、数据绑定和类型转换" data-url="https://HaleLu.github.io/2020/05/spring-4/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Hale Lu">
          <p class="site-author-name" itemprop="name">Hale Lu</p>
          <p class="site-description motion-element" itemprop="description">一只欠觉的开发狗</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">41</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/halelu" target="_blank" title="Github">
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/hao-lu-42-29" target="_blank" title="知乎">
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://wpa.qq.com/msgrd?v=3&uin=773622805&site=qq&menu=yes" target="_blank" title="QQ">
                  
                  QQ
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa fa-globe fa-fw"></i>
              各路大神
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://pmextra.github.io/" title="PM Extra's Blog" target="_blank">PM Extra's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://hzlclock.wordpress.com/" title="Hebert's Blog" target="_blank">Hebert's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.rexskz.info/" title="Rex's Blog" target="_blank">Rex's Blog</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#验证、数据绑定和类型转换"><span class="nav-number">1.</span> <span class="nav-text">验证、数据绑定和类型转换</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Spring-的-Validator-接口进行验证"><span class="nav-number">1.1.</span> <span class="nav-text">使用 Spring 的 Validator 接口进行验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将代码解析为错误消息"><span class="nav-number">1.2.</span> <span class="nav-text">将代码解析为错误消息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bean-操作和-BeanWrapper"><span class="nav-number">1.3.</span> <span class="nav-text">Bean 操作和 BeanWrapper</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设置和获取基本和嵌套属性"><span class="nav-number">1.3.1.</span> <span class="nav-text">设置和获取基本和嵌套属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内置的-PropertyEditor-实现"><span class="nav-number">1.3.2.</span> <span class="nav-text">内置的 PropertyEditor 实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#注册其他自定义-PropertyEditor-实现"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">注册其他自定义 PropertyEditor 实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-类型转换"><span class="nav-number">1.4.</span> <span class="nav-text">Spring 类型转换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#转换器-SPI"><span class="nav-number">1.4.1.</span> <span class="nav-text">转换器 SPI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-ConverterFactory"><span class="nav-number">1.4.2.</span> <span class="nav-text">使用 ConverterFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-GenericConverter"><span class="nav-number">1.4.3.</span> <span class="nav-text">使用 GenericConverter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-ConditionalGenericConverter"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">使用 ConditionalGenericConverter</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConversionService-API"><span class="nav-number">1.4.4.</span> <span class="nav-text">ConversionService API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册一个-ConversionService"><span class="nav-number">1.4.5.</span> <span class="nav-text">注册一个 ConversionService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-ConversionService-编码"><span class="nav-number">1.4.6.</span> <span class="nav-text">使用 ConversionService 编码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-字段格式"><span class="nav-number">1.5.</span> <span class="nav-text">Spring 字段格式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Formatter-SPI"><span class="nav-number">1.5.1.</span> <span class="nav-text">Formatter SPI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注释驱动的格式"><span class="nav-number">1.5.2.</span> <span class="nav-text">注释驱动的格式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#格式注释-API"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">格式注释 API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FormatterRegistry-SPI"><span class="nav-number">1.5.3.</span> <span class="nav-text">FormatterRegistry SPI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FormatterRegistrar-SPI"><span class="nav-number">1.5.4.</span> <span class="nav-text">FormatterRegistrar SPI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在-Spring-MVC-中配置格式"><span class="nav-number">1.5.5.</span> <span class="nav-text">在 Spring MVC 中配置格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置全局日期和时间格式"><span class="nav-number">1.5.6.</span> <span class="nav-text">配置全局日期和时间格式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-Bean-验证"><span class="nav-number">1.6.</span> <span class="nav-text">Java Bean 验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Bean-验证概述"><span class="nav-number">1.6.1.</span> <span class="nav-text">Bean 验证概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-Bean-验证提供程序"><span class="nav-number">1.6.2.</span> <span class="nav-text">配置 Bean 验证提供程序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#注入验证器"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">注入验证器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置自定义约束"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">配置自定义约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-驱动方法验证"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">Spring 驱动方法验证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他配置选项"><span class="nav-number">1.6.2.4.</span> <span class="nav-text">其他配置选项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册一个-DataBinder"><span class="nav-number">1.6.3.</span> <span class="nav-text">注册一个 DataBinder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-MVC-3-Validation"><span class="nav-number">1.6.4.</span> <span class="nav-text">Spring MVC 3 Validation</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hale Lu</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"halelu"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("ABk8fYaVcvf6P6IuuGNY2rRa-gzGzoHsz", "3Vpj3qkDsPj8Rlh92mHOxAMV");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
