<!doctype html>



  


<html class="theme-next pisces use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="阅读,Spring,Java,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="书接上文 接下来到 Spring framework core 的第四大块 —— spring 表达式语言（SpEL）">
<meta name="keywords" content="阅读,Spring,Java">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring进阶 - spring 表达式语言（SpEL）">
<meta property="og:url" content="https://HaleLu.github.io/2020/06/spring-5/index.html">
<meta property="og:site_name" content="Move your idea forward.">
<meta property="og:description" content="书接上文 接下来到 Spring framework core 的第四大块 —— spring 表达式语言（SpEL）">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-06-05T10:49:51.937Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring进阶 - spring 表达式语言（SpEL）">
<meta name="twitter:description" content="书接上文 接下来到 Spring framework core 的第四大块 —— spring 表达式语言（SpEL）">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6279916590628603000,
      author: '（博主大人~）'
    }
  };
</script>

  <title> Spring进阶 - spring 表达式语言（SpEL） | Move your idea forward. </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-77199457-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Move your idea forward.</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Hale Lu's Blog</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br>
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Spring进阶 - spring 表达式语言（SpEL）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-06-01T01:43:49+08:00" content="2020-06-01">
              2020-06-01
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2020/06/spring-5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/06/spring-5/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2020/06/spring-5/" class="leancloud_visitors" data-flag-title="Spring进阶 - spring 表达式语言（SpEL）">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>书接<a href="https://halelu.github.io/2020/05/spring-4/">上文</a></p>
<p>接下来到 Spring framework core 的第四大块 —— spring 表达式语言（SpEL）</p>
<a id="more"></a>

<h1 id="spring-表达式语言（SpEL）"><a href="#spring-表达式语言（SpEL）" class="headerlink" title="spring 表达式语言（SpEL）"></a>spring 表达式语言（SpEL）</h1><p>Spring 表达式语言（简称“SpEL”）是一种功能强大的表达式语言，支持在运行时查询和操作对象图。语言语法与 Unified EL 相似，但提供了其他功能，最著名的是方法调用和基本的字符串模板功能。</p>
<p>尽管还有其他几种 Java 表达式语言可用-OGNL，MVEL 和 JBoss EL，仅举几例-Spring 表达式语言的创建是为了向 Spring 社区提供一种受良好支持的表达式语言，该语言可用于以下版本中的所有产品春季投资组合。它的语言功能受 Spring 产品组合中项目的要求驱动，包括 Spring Tools for Eclipse 中代码完成支持的工具要求。也就是说，SpEL 基于与技术无关的 API，如果需要，可以将其他表达语言实现集成在一起。</p>
<p>虽然 SpEL 是 Spring 产品组合中表达评估的基础，但它并不直接与 Spring 绑定，可以独立使用。为了自成一体，本章中的许多示例都将 SpEL 用作独立的表达语言。这需要创建一些自举基础结构类，例如解析器。 Spring 的大多数用户不需要处理这种基础结构，而只能编写表达式字符串进行评估。这种典型用法的一个示例是将 SpEL 集成到创建 XML 或基于注释的 Bean 定义中，如 Expression 支持中定义的 Bean 定义所示。</p>
<p>本章介绍了表达语言，其 API 和语言语法的功能。在许多地方，Inventor 和 Society 类都用作表达评估的目标对象。这些类声明和用于填充它们的数据在本章末尾列出。</p>
<p>表达式语言支持以下功能：</p>
<ul>
<li>文字表达</li>
<li>布尔运算符和关系运算符</li>
<li>正则表达式</li>
<li>类表达式</li>
<li>访问属性，数组，列表和映射</li>
<li>方法调用</li>
<li>关系运算符</li>
<li>分配</li>
<li>调用构造函数</li>
<li>Bean 引用</li>
<li>数组构造</li>
<li>内联列表</li>
<li>内联映射</li>
<li>三元运算符</li>
<li>变数</li>
<li>用户定义的功能</li>
<li>集合投影</li>
<li>集合选择</li>
<li>模板表达式</li>
</ul>
<h2 id="求值"><a href="#求值" class="headerlink" title="求值"></a>求值</h2><p>本节介绍 SpEL 接口及其表达语言的简单用法。 完整的语言参考可以在<a href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/spring-framework-reference/core.html#expressions-language-ref" target="_blank" rel="noopener">“语言参考”</a>中找到。</p>
<p>以下代码介绍了 SpEL API，用于计算文字字符串表达式 <code>Hello World</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">"'Hello World'"</span>);</span><br><span class="line">String message = (String) exp.getValue();</span><br></pre></td></tr></table></figure>

<p>message 变量的值为“ Hello World”。</p>
<p>您最可能使用的 SpEL 类和接口位于 <code>org.springframework.expression</code> 包及其子包中，例如 <code>spel.support</code>。</p>
<p><code>ExpressionParser</code> 接口负责解析表达式字符串。在前面的示例中，表达式字符串是由周围的单引号表示的字符串文字。<code>Expression</code> 接口负责评估先前定义的表达式字符串。分别调用 parser.<code>parseExpression</code> 和 <code>exp.getValue</code> 时，可以引发两个异常 <code>ParseException</code> 和 <code>EvaluationException</code>。</p>
<p>SpEL 支持多种功能，例如调用方法，访问属性和调用构造函数。</p>
<p>在以下方法调用示例中，我们在字符串文字上调用 <code>concat</code> 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">"'Hello World'.concat('!')"</span>);</span><br><span class="line">String message = (String) exp.getValue();</span><br></pre></td></tr></table></figure>

<p>message == ‘Hello World!’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line"><span class="comment">// invokes 'getBytes()'</span></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">"'Hello World'.bytes"</span>);</span><br><span class="line"><span class="keyword">byte</span>[] bytes = (<span class="keyword">byte</span>[]) exp.getValue();</span><br></pre></td></tr></table></figure>

<p>SpEL 还通过使用标准的点符号（例如 prop1.prop2.prop3）以及相应的属性值设置来支持嵌套属性。 也可以访问公共字段。</p>
<p>下面的示例演示如何使用点表示法获取文字的长度：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line"><span class="comment">// invokes 'getBytes().length'</span></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">"'Hello World'.bytes.length"</span>);</span><br><span class="line"><span class="keyword">int</span> length = (Integer) exp.getValue();</span><br></pre></td></tr></table></figure>

<p>可以调用 String 的构造函数，而不是使用字符串文字，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">"new String('hello world').toUpperCase()"</span>);</span><br><span class="line">String message = exp.getValue(String.class);</span><br></pre></td></tr></table></figure>

<p>上例会从文字构造一个新的 String 并将其变为大写。</p>
<p>注意使用通用方法：<code>public &lt;T&gt; T getValue(Class&lt;T&gt; desiredResultType)</code>。使用此方法无需将表达式的值强制转换为所需的结果类型。 如果该值不能转换为 <code>T</code> 类型或无法使用已注册的类型转换器转换，则将引发 <code>EvaluationException</code>。</p>
<p>SpEL 的更常见用法是提供一个针对特定对象实例（称为根对象）进行评估的表达式字符串。 以下示例显示如何从 <code>Inventor</code> 类的实例检索 <code>name</code> 属性或如何创建布尔条件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create and set a calendar</span></span><br><span class="line">GregorianCalendar c = <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">c.set(<span class="number">1856</span>, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The constructor arguments are name, birthday, and nationality.</span></span><br><span class="line">Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string">"Nikola Tesla"</span>, c.getTime(), <span class="string">"Serbian"</span>);</span><br><span class="line"></span><br><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line">Expression exp = parser.parseExpression(<span class="string">"name"</span>); <span class="comment">// Parse name as an expression</span></span><br><span class="line">String name = (String) exp.getValue(tesla);</span><br><span class="line"><span class="comment">// name == "Nikola Tesla"</span></span><br><span class="line"></span><br><span class="line">exp = parser.parseExpression(<span class="string">"name == 'Nikola Tesla'"</span>);</span><br><span class="line"><span class="keyword">boolean</span> result = exp.getValue(tesla, Boolean.class);</span><br><span class="line"><span class="comment">// result == true</span></span><br></pre></td></tr></table></figure>

<h3 id="理解-EvaluationContext"><a href="#理解-EvaluationContext" class="headerlink" title="理解 EvaluationContext"></a>理解 <code>EvaluationContext</code></h3><p>在评估表达式以解析属性，方法或字段并帮助执行类型转换时，使用 <code>EvaluationContext</code> 接口。 Spring 提供了两种实现。</p>
<ul>
<li><code>SimpleEvaluationContext</code>：针对不需要全部 SpEL 语言语法范围且应受到有意义限制的表达式类别，公开了 SpEL 基本语言功能和配置选项的子集。示例包括但不限于数据绑定表达式和基于属性的过滤器。</li>
<li><code>StandardEvaluationContext</code>：公开了全套 SpEL 语言功能和配置选项。您可以使用它来指定默认的根对象并配置每个可用的评估相关策略。</li>
</ul>
<p><code>SimpleEvaluationContext</code> 设计为仅支持 SpEL 语言语法的子集。它不包括 Java 类型引用，构造函数和 Bean 引用。它还要求您明确选择对表达式中的属性和方法的支持级别。默认情况下，<code>create()</code> 静态工厂方法仅启用对属性的读取访问。您还可以获取构建器来配置所需的确切支持级别，并针对以下一种或某种组合：</p>
<ul>
<li>仅自定义 <code>PropertyAccessor</code>（无反射）</li>
<li>只读访问的数据绑定属性</li>
<li>读写的数据绑定属性</li>
</ul>
<h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><p>默认情况下，SpEL 使用 Spring 核心中可用的转换服务（<code>org.springframework.core.convert.ConversionService</code>）。此转换服务附带许多内置转换器，用于常见转换，但也可以完全扩展，以便您可以在类型之间添加自定义转换。此外，它是泛型感知的。这意味着，当您在表达式中使用泛型类型时，SpEL 会尝试进行转换以维护遇到的任何对象的类型正确性。</p>
<p>实际上这是什么意思？假设使用 <code>setValue()</code> 进行赋值来设置 <code>List</code> 属性。该属性的类型实际上是 <code>List&lt;Boolean&gt;</code>。 SpEL 认识到列表中的元素在放入列表之前需要转换为布尔值。以下示例显示了如何执行此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Simple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Boolean&gt; booleanList = <span class="keyword">new</span> ArrayList&lt;Boolean&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Simple simple = <span class="keyword">new</span> Simple();</span><br><span class="line">simple.booleanList.add(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// "false" is passed in here as a String. SpEL and the conversion service</span></span><br><span class="line"><span class="comment">// will recognize that it needs to be a Boolean and convert it accordingly.</span></span><br><span class="line">parser.parseExpression(<span class="string">"booleanList[0]"</span>).setValue(context, simple, <span class="string">"false"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// b is false</span></span><br><span class="line">Boolean b = simple.booleanList.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="解析器配置"><a href="#解析器配置" class="headerlink" title="解析器配置"></a>解析器配置</h3><p>可以使用解析器配置对象（<code>org.springframework.expression.spel.SpelParserConfiguration</code>）配置 SpEL 表达式解析器。 配置对象控制某些表达式组件的行为。 例如，如果您索引到数组或集合中并且指定索引处的元素为 <code>null</code>，则可以自动创建该元素。 当使用由属性引用链组成的表达式时，这很有用。 如果您索引到数组或列表中并指定了超出数组或列表当前大小末尾的索引，则可以自动增长数组或列表以容纳该索引。下面的示例演示如何自动增加列表：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Turn on:</span></span><br><span class="line"><span class="comment">// - auto null reference initialization</span></span><br><span class="line"><span class="comment">// - auto collection growing</span></span><br><span class="line">SpelParserConfiguration config = <span class="keyword">new</span> SpelParserConfiguration(<span class="keyword">true</span>,<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser(config);</span><br><span class="line"></span><br><span class="line">Expression expression = parser.parseExpression(<span class="string">"list[3]"</span>);</span><br><span class="line"></span><br><span class="line">Demo demo = <span class="keyword">new</span> Demo();</span><br><span class="line"></span><br><span class="line">Object o = expression.getValue(demo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// demo.list will now be a real collection of 4 entries</span></span><br><span class="line"><span class="comment">// Each entry is a new empty String</span></span><br></pre></td></tr></table></figure>

<h3 id="SpEL-编译"><a href="#SpEL-编译" class="headerlink" title="SpEL 编译"></a>SpEL 编译</h3><p>Spring Framework 4.1 包含一个基本的表达式编译器。通常对表达式进行解释，这样可以在评估过程中提供很大的动态灵活性，但不能提供最佳性能。对于偶尔使用表达式，这很好，但是，当与其他组件（例如 Spring Integration）一起使用时，性能可能非常重要，并且不需要动态性。</p>
<p>SpEL 编译器旨在满足这一需求。在评估过程中，编译器会生成一个 Java 类，该类体现了运行时的表达式行为，并使用该类来实现更快的表达式评估。由于缺少在表达式周围输入内容的信息，因此编译器在执行编译时会使用在表达式的解释式求值过程中收集的信息。例如，它不仅仅从表达式中就知道属性引用的类型，而是在第一次解释求值时就知道它是什么。当然，如果各种表达元素的类型随时间变化，则基于此类派生信息进行编译会在以后引起麻烦。因此，编译最适合类型信息在重复求值时不会改变的表达式。</p>
<p>考虑以下基本表达式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">someArray[0].someProperty.someOtherProperty &lt; 0.1</span><br></pre></td></tr></table></figure>

<p>由于前面的表达式涉及数组访问，一些属性取消引用和数字运算，因此性能提升可能非常明显。在一个示例中，进行了 50000 次迭代的微基准测试，使用解释器评估需要 75 毫秒，而使用表达式的编译版本仅需要 3 毫秒。</p>
<h4 id="编译器配置"><a href="#编译器配置" class="headerlink" title="编译器配置"></a>编译器配置</h4><p>两种不同的方式之一来打开它。当 SpEL 用法嵌入到另一个组件中时，可以使用解析器配置过程（前面讨论过）或使用系统属性来打开它。本节讨论这两个选项。</p>
<p>编译器可以在 <code>org.springframework.expression.spel.SpelCompilerMode</code> 枚举中捕获的三种模式之一进行操作。模式如下：</p>
<ul>
<li><code>OFF</code>（默认）：编译器已关闭。</li>
<li><code>IMMEDIATE</code>：在立即模式下，将尽快编译表达式。通常是在第一次解释评估之后。如果编译的表达式失败（通常是由于类型更改，如前所述），则表达式求值的调用者将收到异常。</li>
<li><code>MIXED</code>：在混合模式下，表达式会随着时间静默在解释模式和编译模式之间切换。经过一定数量的解释运行后，它们会切换到编译形式，如果编译形式出了问题（例如，如前面所述的类型更改），则表达式会自动再次切换回解释形式。稍后，它可能会生成另一个已编译的表单并切换到该表单。基本上，用户进入即时模式的异常是在内部处理的。</li>
</ul>
<p>存在 <code>IMMEDIATE</code> 模式是因为 <code>MIXED</code> 模式可能会导致具有副作用的表达式出现问题。如果已编译的表达式在部分成功后就崩溃了，则它可能已经完成了影响系统状态的操作。如果发生这种情况，调用者可能不希望它在解释模式下静默地重新运行，因为表达式的一部分可能运行了两次。</p>
<p>选择模式后，使用 <code>SpelParserConfiguration</code> 配置解析器。以下示例显示了如何执行此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SpelParserConfiguration config = <span class="keyword">new</span> SpelParserConfiguration(SpelCompilerMode.IMMEDIATE,</span><br><span class="line">    <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line"></span><br><span class="line">SpelExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser(config);</span><br><span class="line"></span><br><span class="line">Expression expr = parser.parseExpression(<span class="string">"payload"</span>);</span><br><span class="line"></span><br><span class="line">MyMessage message = <span class="keyword">new</span> MyMessage();</span><br><span class="line"></span><br><span class="line">Object payload = expr.getValue(message);</span><br></pre></td></tr></table></figure>

<p>当指定编译器模式时，还可以指定一个类加载器（允许传递 null）。编译的表达式在提供的任何子类加载器中定义。重要的是要确保，如果指定了类加载器，则它可以查看表达式评估过程中涉及的所有类型。如果未指定类加载器，则使用默认的类加载器（通常是在表达式求值期间运行的线程的上下文类加载器）。</p>
<p>第二种配置编译器的方法是将 SpEL 嵌入到其他组件中，并且可能无法通过配置对象进行配置。 在这些情况下，可以使用系统属性。 您可以将 <code>spring.expression.compiler.mode</code> 属性设置为 <code>SpelCompilerMode</code> 枚举值之一（<code>off</code>、<code>immediate</code> 或 <code>mixed</code>）。</p>
<h4 id="编译器限制"><a href="#编译器限制" class="headerlink" title="编译器限制"></a>编译器限制</h4><p>从 Spring Framework 4.1 开始，已经有了基本的编译框架。但是，该框架尚不支持编译每种表达式。最初的重点是可能在性能关键型上下文中使用的通用表达式。目前无法编译以下类型的表达式：</p>
<ul>
<li>涉及赋值的表达</li>
<li>表达式依赖转换服务</li>
<li>使用自定义解析器或访问器的表达式</li>
<li>使用选择或投影的表达式</li>
</ul>
<p>将来会编译更多类型的表达。</p>
<h2 id="Bean-定义中的表达式"><a href="#Bean-定义中的表达式" class="headerlink" title="Bean 定义中的表达式"></a>Bean 定义中的表达式</h2><p>您可以将 SpEL 表达式与基于 XML 或基于注释的配置元数据一起使用，以定义 <code>BeanDefinition</code> 实例。 在这两种情况下，用于定义表达式的语法都采用 <code>#{ &lt;expression string&gt; }</code> 的形式。</p>
<h3 id="XML-配置"><a href="#XML-配置" class="headerlink" title="XML 配置"></a>XML 配置</h3><p>可以使用表达式来设置属性或构造函数参数值，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"numberGuess"</span> <span class="attr">class</span>=<span class="string">"org.spring.samples.NumberGuess"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"randomNumber"</span> <span class="attr">value</span>=<span class="string">"#&#123; T(java.lang.Math).random() * 100.0 &#125;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>应用程序上下文中的所有 bean 都可以使用其公共 bean 名称作为预定义变量使用。 这包括标准上下文 Bean，例如用于访问运行时环境的 <code>environment</code>（类型为 <code>org.springframework.core.env.Environment</code>）以及 <code>systemProperties</code> 和 <code>systemEnvironment</code>（类型为 <code>Map&lt;String，Object&gt;</code>）。</p>
<p>下面的示例显示了如何对 <code>systemProperties</code> bean 作为 SpEL 变量的访问：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"taxCalculator"</span> <span class="attr">class</span>=<span class="string">"org.spring.samples.TaxCalculator"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultLocale"</span> <span class="attr">value</span>=<span class="string">"#&#123; systemProperties['user.region'] &#125;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>请注意，此处不必在预定义变量前加上 <code>＃</code> 符号。</p>
<p>您还可以按名称引用其他 bean 属性，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"numberGuess"</span> <span class="attr">class</span>=<span class="string">"org.spring.samples.NumberGuess"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"randomNumber"</span> <span class="attr">value</span>=<span class="string">"#&#123; T(java.lang.Math).random() * 100.0 &#125;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shapeGuess"</span> <span class="attr">class</span>=<span class="string">"org.spring.samples.ShapeGuess"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialShapeSeed"</span> <span class="attr">value</span>=<span class="string">"#&#123; numberGuess.randomNumber &#125;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- other properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h3><p>若要指定默认值，可以将 <code>@Value</code> 批注放置在字段，方法以及方法或构造函数参数上。</p>
<p>下面的示例设置字段变量的默认值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldValueTestBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"#&#123; systemProperties['user.region'] &#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultLocale</span><span class="params">(String defaultLocale)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDefaultLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下示例显示了等效的但使用属性设置器方法的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyValueTestBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"#&#123; systemProperties['user.region'] &#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultLocale</span><span class="params">(String defaultLocale)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDefaultLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动装配的方法和构造函数也可以使用 @Value 批注，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleMovieLister</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(MovieFinder movieFinder,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Value(<span class="string">"#&#123; systemProperties['user.region'] &#125;"</span>)</span> String defaultLocale) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.movieFinder = movieFinder;</span><br><span class="line">        <span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Value(<span class="string">"#&#123;systemProperties['user.country']&#125;"</span>)</span> String defaultLocale) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">        <span class="keyword">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="语言参考"><a href="#语言参考" class="headerlink" title="语言参考"></a>语言参考</h2><p>本节描述了 Spring Expression Language 的工作方式。 它涵盖以下主题：</p>
<ul>
<li>文字表达式</li>
<li>属性，数组，列表，映射和索引器</li>
<li>内联列表</li>
<li>内联映射</li>
<li>数组构造</li>
<li>方法</li>
<li>运算符</li>
<li>类型</li>
<li>构造器</li>
<li>变数</li>
<li>函数</li>
<li>Bean 引用</li>
<li>三元运算符（If-Then-Else）</li>
<li>Elvis 运算符</li>
<li>安全导航运算符</li>
</ul>
<h3 id="文字表达式"><a href="#文字表达式" class="headerlink" title="文字表达式"></a>文字表达式</h3><p>支持的文字表达式的类型为字符串，数值（int，实数，十六进制），布尔值和 null。 字符串由单引号引起来。 要将单引号本身放在字符串中，请使用两个单引号字符。</p>
<p>以下清单显示了文字的简单用法。 通常，它们不是像这样孤立地使用，而是作为更复杂的表达式的一部分使用-例如，在逻辑比较运算符的一侧使用文字。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line"><span class="comment">// evals to "Hello World"</span></span><br><span class="line">String helloWorld = (String) parser.parseExpression(<span class="string">"'Hello World'"</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> avogadrosNumber = (Double) parser.parseExpression(<span class="string">"6.0221415E+23"</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// evals to 2147483647</span></span><br><span class="line"><span class="keyword">int</span> maxValue = (Integer) parser.parseExpression(<span class="string">"0x7FFFFFFF"</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> trueValue = (Boolean) parser.parseExpression(<span class="string">"true"</span>).getValue();</span><br><span class="line"></span><br><span class="line">Object nullValue = parser.parseExpression(<span class="string">"null"</span>).getValue();</span><br></pre></td></tr></table></figure>

<p>数字支持使用负号，指数符号和小数点。 默认情况下，使用 Double.parseDouble()解析实数。</p>
<h3 id="属性，数组，列表，映射和索引器"><a href="#属性，数组，列表，映射和索引器" class="headerlink" title="属性，数组，列表，映射和索引器"></a>属性，数组，列表，映射和索引器</h3><p>使用属性引用进行导航很容易。为此，请使用句点来指示嵌套的属性值。<code>Inventor</code> 类的实例 <code>pupin</code> 和 <code>tesla</code> 填充有 <a href="#示例中使用的类">示例中使用的类</a> 中列出的数据。要向下导航并获取特斯拉(Tesla)的出生年份和普平(Pupin)的出生城市，我们使用以下表达式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evals to 1856</span></span><br><span class="line"><span class="keyword">int</span> year = (Integer) parser.parseExpression(<span class="string">"Birthdate.Year + 1900"</span>).getValue(context);</span><br><span class="line"></span><br><span class="line">String city = (String) parser.parseExpression(<span class="string">"placeOfBirth.City"</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p>属性名称的首字母允许不区分大小写。 数组和列表的内容通过使用方括号表示法获得，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inventions Array</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to "Induction motor"</span></span><br><span class="line">String invention = parser.parseExpression(<span class="string">"inventions[3]"</span>).getValue(</span><br><span class="line">        context, tesla, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Members List</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to "Nikola Tesla"</span></span><br><span class="line">String name = parser.parseExpression(<span class="string">"Members[0].Name"</span>).getValue(</span><br><span class="line">        context, ieee, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// List and Array navigation</span></span><br><span class="line"><span class="comment">// evaluates to "Wireless communication"</span></span><br><span class="line">String invention = parser.parseExpression(<span class="string">"Members[0].Inventions[6]"</span>).getValue(</span><br><span class="line">        context, ieee, String.class);</span><br></pre></td></tr></table></figure>

<p>通过在方括号内指定文字键值可以获取映射的内容。 在下面的示例中，由于 Officer 映射的键是字符串，因此我们可以指定字符串文字：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Officer's Dictionary</span></span><br><span class="line"></span><br><span class="line">Inventor pupin = parser.parseExpression(<span class="string">"Officers['president']"</span>).getValue(</span><br><span class="line">        societyContext, Inventor.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to "Idvor"</span></span><br><span class="line">String city = parser.parseExpression(<span class="string">"Officers['president'].PlaceOfBirth.City"</span>).getValue(</span><br><span class="line">        societyContext, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// setting values</span></span><br><span class="line">parser.parseExpression(<span class="string">"Officers['advisors'][0].PlaceOfBirth.Country"</span>).setValue(</span><br><span class="line">        societyContext, <span class="string">"Croatia"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="内联列表"><a href="#内联列表" class="headerlink" title="内联列表"></a>内联列表</h3><p>您可以使用 <code>{}</code> 表示法在表达式中直接表达列表。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to a Java list containing the four numbers</span></span><br><span class="line">List numbers = (List) parser.parseExpression(<span class="string">"&#123;1,2,3,4&#125;"</span>).getValue(context);</span><br><span class="line"></span><br><span class="line">List listOfLists = (List) parser.parseExpression(<span class="string">"&#123;&#123;'a','b'&#125;,&#123;'x','y'&#125;&#125;"</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p><code>{}</code> 本身表示一个空列表。出于性能原因，如果列表本身完全由固定文字组成，则会创建一个常量列表来表示该表达式（而不是在每次求值时都建立一个新列表）。</p>
<h3 id="内联映射"><a href="#内联映射" class="headerlink" title="内联映射"></a>内联映射</h3><p>您也可以使用 <code>{key:value}</code> 表示法在表达式中直接表达映射。以下示例显示了如何执行此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to a Java map containing the two entries</span></span><br><span class="line">Map inventorInfo = (Map) parser.parseExpression(<span class="string">"&#123;name:'Nikola',dob:'10-July-1856'&#125;"</span>).getValue(context);</span><br><span class="line"></span><br><span class="line">Map mapOfMaps = (Map) parser.parseExpression(<span class="string">"&#123;name:&#123;first:'Nikola',last:'Tesla'&#125;,dob:&#123;day:10,month:'July',year:1856&#125;&#125;"</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p><code>{:}</code> 本身意味着一个空的映射。出于性能原因，如果映射图本身由固定的文字或其他嵌套的常量结构（列表或映射）组成，则会创建一个常量映射来表示该表达式（而不是在每次求值时都构建一个新的映射）。映射键的引号是可选的。上面的示例使用的是不带引号的键。</p>
<h3 id="构建数组"><a href="#构建数组" class="headerlink" title="构建数组"></a>构建数组</h3><p>您可以使用熟悉的 Java 语法来构建数组，可以选择提供一个初始化程序，以在构造时填充该数组。 以下示例显示了如何执行此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] numbers1 = (<span class="keyword">int</span>[]) parser.parseExpression(<span class="string">"new int[4]"</span>).getValue(context);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array with initializer</span></span><br><span class="line"><span class="keyword">int</span>[] numbers2 = (<span class="keyword">int</span>[]) parser.parseExpression(<span class="string">"new int[]&#123;1,2,3&#125;"</span>).getValue(context);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Multi dimensional array</span></span><br><span class="line"><span class="keyword">int</span>[][] numbers3 = (<span class="keyword">int</span>[][]) parser.parseExpression(<span class="string">"new int[4][5]"</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p>构造多维数组时，当前无法提供初始化程序。</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>您可以使用典型的 Java 编程语法来调用方法。 您还可以在文字上调用方法。 还支持变量参数。 下面的示例演示如何调用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string literal, evaluates to "bc"</span></span><br><span class="line">String bc = parser.parseExpression(<span class="string">"'abc'.substring(1, 3)"</span>).getValue(String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="keyword">boolean</span> isMember = parser.parseExpression(<span class="string">"isMember('Mihajlo Pupin')"</span>).getValue(</span><br><span class="line">        societyContext, Boolean.class);</span><br></pre></td></tr></table></figure>

<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p>Spring 表达式语言支持以下几种运算符：</p>
<ul>
<li>关系运算符</li>
<li>逻辑运算符</li>
<li>数学运算符</li>
<li>赋值运算符</li>
</ul>
<h4 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h4><p>使用标准运算符表示法支持关系运算符（等于，不等于，小于，小于或等于，大于和大于或等于）。 以下清单显示了一些运算符示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="keyword">boolean</span> trueValue = parser.parseExpression(<span class="string">"2 == 2"</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="keyword">boolean</span> falseValue = parser.parseExpression(<span class="string">"2 &lt; -5.0"</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="keyword">boolean</span> trueValue = parser.parseExpression(<span class="string">"'black' &lt; 'block'"</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对 <code>null</code> 的大于和小于比较遵循一个简单的规则：<code>null</code> 被视为无（不是零）。结果，任何其他值始终大于 <code>null</code>（<code>X &gt; null</code> 始终为 <code>true</code>），并且其他任何值都不小于零（<code>X &lt; null</code> 始终为 <code>false</code>）。</p>
<p>如果您需要数字比较，请避免使用基于数字的 <code>null</code> 比较，而建议使用零进行比较（例如，<code>X &gt; 0</code> 或 <code>X &lt; 0</code>）。</p>
</blockquote>
<p>除了标准的关系运算符外，SpEL 还支持 <code>instanceof</code> 和基于正则表达式的匹配运算符。 以下清单显示了两个示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="keyword">boolean</span> falseValue = parser.parseExpression(</span><br><span class="line">        <span class="string">"'xyz' instanceof T(Integer)"</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="keyword">boolean</span> trueValue = parser.parseExpression(</span><br><span class="line">        <span class="string">"'5.00' matches '^-?\\d+(\\.\\d&#123;2&#125;)?$'"</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//evaluates to false</span></span><br><span class="line"><span class="keyword">boolean</span> falseValue = parser.parseExpression(</span><br><span class="line">        <span class="string">"'5.0067' matches '^-?\\d+(\\.\\d&#123;2&#125;)?$'"</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>请注意原始类型，因为它们会立即被包装为包装器类型，因此，按预期方式，<code>1 instanceof T(int)</code> 的计算结果为 <code>false</code>，而 <code>1 instanceof T(Integer)</code> 的计算结果为 <code>true</code>。</p>
</blockquote>
<p>每个符号运算符也可以指定为纯字母等效项。 这样可以避免使用的符号对于嵌入表达式的文档类型具有特殊含义的问题（例如在 XML 文档中）。等效的文字是：</p>
<ul>
<li>lt (&lt;)</li>
<li>gt (&gt;)</li>
<li>le (&lt;=)</li>
<li>ge (&gt;=)</li>
<li>eq (==)</li>
<li>ne (!=)</li>
<li>div (/)</li>
<li>mod (%)</li>
<li>not (!)</li>
</ul>
<p>所有的文本运算符都不区分大小写。</p>
<h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><p>SpEL 支持以下逻辑运算符：</p>
<ul>
<li>与（<code>&amp;&amp;</code>）</li>
<li>或（<code>||</code>）</li>
<li>非（<code>!</code>）</li>
</ul>
<p>下面的示例演示如何使用逻辑运算符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -- AND --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="keyword">boolean</span> falseValue = parser.parseExpression(<span class="string">"true and false"</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line">String expression = <span class="string">"isMember('Nikola Tesla') and isMember('Mihajlo Pupin')"</span>;</span><br><span class="line"><span class="keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- OR --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line"><span class="keyword">boolean</span> trueValue = parser.parseExpression(<span class="string">"true or false"</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to true</span></span><br><span class="line">String expression = <span class="string">"isMember('Nikola Tesla') or isMember('Albert Einstein')"</span>;</span><br><span class="line"><span class="keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- NOT --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to false</span></span><br><span class="line"><span class="keyword">boolean</span> falseValue = parser.parseExpression(<span class="string">"!true"</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- AND and NOT --</span></span><br><span class="line">String expression = <span class="string">"isMember('Nikola Tesla') and !isMember('Mihajlo Pupin')"</span>;</span><br><span class="line"><span class="keyword">boolean</span> falseValue = parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br></pre></td></tr></table></figure>

<h4 id="数学运算符"><a href="#数学运算符" class="headerlink" title="数学运算符"></a>数学运算符</h4><p>您可以在数字和字符串上使用加法运算符。 您只能对数字使用减法，乘法和除法运算符。 您还可以使用模数（％）和指数幂（^）运算符。 强制执行标准运算符优先级。 以下示例显示了正在使用的数学运算符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Addition</span></span><br><span class="line"><span class="keyword">int</span> two = parser.parseExpression(<span class="string">"1 + 1"</span>).getValue(Integer.class);  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">String testString = parser.parseExpression(</span><br><span class="line">        <span class="string">"'test' + ' ' + 'string'"</span>).getValue(String.class);  <span class="comment">// 'test string'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Subtraction</span></span><br><span class="line"><span class="keyword">int</span> four = parser.parseExpression(<span class="string">"1 - -3"</span>).getValue(Integer.class);  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> d = parser.parseExpression(<span class="string">"1000.00 - 1e4"</span>).getValue(Double.class);  <span class="comment">// -9000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Multiplication</span></span><br><span class="line"><span class="keyword">int</span> six = parser.parseExpression(<span class="string">"-2 * -3"</span>).getValue(Integer.class);  <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> twentyFour = parser.parseExpression(<span class="string">"2.0 * 3e0 * 4"</span>).getValue(Double.class);  <span class="comment">// 24.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Division</span></span><br><span class="line"><span class="keyword">int</span> minusTwo = parser.parseExpression(<span class="string">"6 / -3"</span>).getValue(Integer.class);  <span class="comment">// -2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> one = parser.parseExpression(<span class="string">"8.0 / 4e0 / 2"</span>).getValue(Double.class);  <span class="comment">// 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Modulus</span></span><br><span class="line"><span class="keyword">int</span> three = parser.parseExpression(<span class="string">"7 % 4"</span>).getValue(Integer.class);  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> one = parser.parseExpression(<span class="string">"8 / 5 % 2"</span>).getValue(Integer.class);  <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Operator precedence</span></span><br><span class="line"><span class="keyword">int</span> minusTwentyOne = parser.parseExpression(<span class="string">"1+2-3*8"</span>).getValue(Integer.class);  <span class="comment">// -21</span></span><br></pre></td></tr></table></figure>

<h4 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h4><p>要设置属性，请使用赋值运算符（=）。 这通常在对 <code>setValue</code> 的调用内完成，但也可以在对 <code>getValue</code> 的调用内完成。 下面的清单显示了使用赋值运算符的两种方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Inventor inventor = <span class="keyword">new</span> Inventor();</span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadWriteDataBinding().build();</span><br><span class="line"></span><br><span class="line">parser.parseExpression(<span class="string">"Name"</span>).setValue(context, inventor, <span class="string">"Aleksandar Seovic"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// alternatively</span></span><br><span class="line">String aleks = parser.parseExpression(</span><br><span class="line">        <span class="string">"Name = 'Aleksandar Seovic'"</span>).getValue(context, inventor, String.class);</span><br></pre></td></tr></table></figure>

<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><p>您可以使用特殊的 <code>T</code> 运算符来指定 <code>java.lang.Class</code>（类型）的实例。静态方法也可以通过使用此运算符来调用。<code>StandardEvaluationContext</code> 使用 <code>TypeLocator</code> 查找类型，而 <code>StandardTypeLocator</code>（可以替换）是在了解 <code>java.lang</code> 包的情况下构建的。 这意味着对 <code>Java.lang</code> 中的类型的 <code>T()</code> 引用不需要完全限定，但是所有其他类型引用都必须是完全限定的。下面的示例演示如何使用 <code>T</code> 运算符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Class dateClass = parser.parseExpression(<span class="string">"T(java.util.Date)"</span>).getValue(Class.class);</span><br><span class="line"></span><br><span class="line">Class stringClass = parser.parseExpression(<span class="string">"T(String)"</span>).getValue(Class.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> trueValue = parser.parseExpression(</span><br><span class="line">        <span class="string">"T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR"</span>)</span><br><span class="line">        .getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<h3 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h3><p>您可以使用 <code>new</code> 运算符来调用构造函数。 除基本类型（<code>int</code>，<code>float</code> 等）和 <code>String</code> 以外的所有其他类都应使用完全限定的类名。 下面的示例演示如何使用 new 运算符调用构造函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Inventor einstein = p.parseExpression(</span><br><span class="line">        <span class="string">"new org.spring.samples.spel.inventor.Inventor('Albert Einstein', 'German')"</span>)</span><br><span class="line">        .getValue(Inventor.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create new inventor instance within add method of List</span></span><br><span class="line">p.parseExpression(</span><br><span class="line">        <span class="string">"Members.add(new org.spring.samples.spel.inventor.Inventor(</span></span><br><span class="line"><span class="string">            'Albert Einstein', 'German'))"</span>).getValue(societyContext);</span><br></pre></td></tr></table></figure>

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>您可以使用 <code>#variableName</code> 语法在表达式中引用变量。 通过在 <code>EvaluationContext</code> 实现上使用 <code>setVariable</code> 方法设置变量。</p>
<blockquote>
<p>有效的变量名称必须由以下一个或多个受支持的字符组成。</p>
<ul>
<li>字母：<code>A</code> 到 <code>Z</code> 和 <code>a</code> 到 <code>z</code></li>
<li>数字：<code>0</code> 到 <code>9</code></li>
<li>下划线：<code>_</code></li>
<li>美元符号：<code>$</code></li>
</ul>
</blockquote>
<p>以下示例显示了如何使用变量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string">"Nikola Tesla"</span>, <span class="string">"Serbian"</span>);</span><br><span class="line"></span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadWriteDataBinding().build();</span><br><span class="line">context.setVariable(<span class="string">"newName"</span>, <span class="string">"Mike Tesla"</span>);</span><br><span class="line"></span><br><span class="line">parser.parseExpression(<span class="string">"Name = #newName"</span>).getValue(context, tesla);</span><br><span class="line">System.out.println(tesla.getName())  <span class="comment">// "Mike Tesla"</span></span><br></pre></td></tr></table></figure>

<h4 id="this-和-root-变量"><a href="#this-和-root-变量" class="headerlink" title="#this 和 #root 变量"></a><code>#this</code> 和 <code>#root</code> 变量</h4><p><code>#this</code> 变量始终是定义的，并且引用当前的评估对象（反对解决不合格的引用）。<code>#root</code> 变量也是始终定义，并引用根上下文对象。尽管 <code>#this</code> 可能随表达式的组成部分的求值而变化，但 <code>#root</code> 始终引用根。 以下示例说明如何使用 <code>#this</code> 和 <code>#root</code> 变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create an array of integers</span></span><br><span class="line">List&lt;Integer&gt; primes = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">primes.addAll(Arrays.asList(<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// create parser and set variable 'primes' as the array of integers</span></span><br><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataAccess();</span><br><span class="line">context.setVariable(<span class="string">"primes"</span>, primes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// all prime numbers &gt; 10 from the list (using selection ?&#123;...&#125;)</span></span><br><span class="line"><span class="comment">// evaluates to [11, 13, 17]</span></span><br><span class="line">List&lt;Integer&gt; primesGreaterThanTen = (List&lt;Integer&gt;) parser.parseExpression(</span><br><span class="line">        <span class="string">"#primes.?[#this&gt;10]"</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>您可以通过注册可以在表达式字符串中调用的用户定义函数来扩展 SpEL。该函数通过 <code>EvaluationContext</code> 注册。下面的示例显示如何注册用户定义的函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Method method = ...;</span><br><span class="line"></span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line">context.setVariable(<span class="string">"myFunction"</span>, method);</span><br></pre></td></tr></table></figure>

<p>例如，考虑以下用于反转字符串的实用程序方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">reverseString</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        StringBuilder backwards = <span class="keyword">new</span> StringBuilder(input.length());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; input.length(); i++) &#123;</span><br><span class="line">            backwards.append(input.charAt(input.length() - <span class="number">1</span> - i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> backwards.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，您可以注册并使用前面的方法，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line">context.setVariable(<span class="string">"reverseString"</span>,</span><br><span class="line">        StringUtils.class.getDeclaredMethod(<span class="string">"reverseString"</span>, String.class));</span><br><span class="line"></span><br><span class="line">String helloWorldReversed = parser.parseExpression(</span><br><span class="line">        <span class="string">"#reverseString('hello')"</span>).getValue(context, String.class);</span><br></pre></td></tr></table></figure>

<h3 id="Bean-引用"><a href="#Bean-引用" class="headerlink" title="Bean 引用"></a>Bean 引用</h3><p>如果评估上下文已使用 bean 解析器配置，则可以使用@符号从表达式中查找 bean。 以下示例显示了如何执行此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();</span><br><span class="line">context.setBeanResolver(<span class="keyword">new</span> MyBeanResolver());</span><br><span class="line"></span><br><span class="line"><span class="comment">// This will end up calling resolve(context,"something") on MyBeanResolver during evaluation</span></span><br><span class="line">Object bean = parser.parseExpression(<span class="string">"@something"</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<p>要访问工厂 bean 本身，您应该在 bean 名称前加上＆符号。 以下示例显示了如何执行此操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">StandardEvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();</span><br><span class="line">context.setBeanResolver(<span class="keyword">new</span> MyBeanResolver());</span><br><span class="line"></span><br><span class="line"><span class="comment">// This will end up calling resolve(context,"&amp;foo") on MyBeanResolver during evaluation</span></span><br><span class="line">Object bean = parser.parseExpression(<span class="string">"&amp;foo"</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<h3 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a>三元表达式</h3><p>您可以使用三元运算符在表达式内部执行 if-then-else 条件逻辑。 以下清单显示了一个最小的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String falseString = parser.parseExpression(</span><br><span class="line">        <span class="string">"false ? 'trueExp' : 'falseExp'"</span>).getValue(String.class);</span><br></pre></td></tr></table></figure>

<p>在这种情况下，布尔值 false 导致返回字符串值’falseExp’。 一个更现实的示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">parser.parseExpression(<span class="string">"Name"</span>).setValue(societyContext, <span class="string">"IEEE"</span>);</span><br><span class="line">societyContext.setVariable(<span class="string">"queryName"</span>, <span class="string">"Nikola Tesla"</span>);</span><br><span class="line"></span><br><span class="line">expression = <span class="string">"isMember(#queryName)? #queryName + ' is a member of the ' "</span> +</span><br><span class="line">        <span class="string">"+ Name + ' Society' : #queryName + ' is not a member of the ' + Name + ' Society'"</span>;</span><br><span class="line"></span><br><span class="line">String queryResultString = parser.parseExpression(expression)</span><br><span class="line">        .getValue(societyContext, String.class);</span><br><span class="line"><span class="comment">// queryResultString = "Nikola Tesla is a member of the IEEE Society"</span></span><br></pre></td></tr></table></figure>

<p>有关三元运算符的更短语法，请参阅关于 Elvis 运算符的下一部分。</p>
<h3 id="Elvis-运算符"><a href="#Elvis-运算符" class="headerlink" title="Elvis 运算符"></a>Elvis 运算符</h3><p>Elvis 运算符是三元运算符语法的简化，并且在 Groovy 语言中使用。 使用三元运算符语法，通常必须将变量重复两次，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name = <span class="string">"Elvis Presley"</span>;</span><br><span class="line">String displayName = (name != <span class="keyword">null</span> ? name : <span class="string">"Unknown"</span>);</span><br></pre></td></tr></table></figure>

<p>相反，您可以使用 Elvis 运算符（其命名类似于 Elvis 的发型）。 以下示例显示了如何使用 Elvis 运算符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line">String name = parser.parseExpression(<span class="string">"name?:'Unknown'"</span>).getValue(<span class="keyword">new</span> Inventor(), String.class);</span><br><span class="line">System.out.println(name);  <span class="comment">// 'Unknown'</span></span><br></pre></td></tr></table></figure>

<p>以下显示了一个更复杂的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line">Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string">"Nikola Tesla"</span>, <span class="string">"Serbian"</span>);</span><br><span class="line">String name = parser.parseExpression(<span class="string">"Name?:'Elvis Presley'"</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(name);  <span class="comment">// Nikola Tesla</span></span><br><span class="line"></span><br><span class="line">tesla.setName(<span class="keyword">null</span>);</span><br><span class="line">name = parser.parseExpression(<span class="string">"Name?:'Elvis Presley'"</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(name);  <span class="comment">// Elvis Presley</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>您可以使用 Elvis 运算符在表达式中应用默认值。 以下示例显示了如何在 <code>@Value</code> 表达式中使用 Elvis 运算符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="meta">@Value</span>(<span class="string">"#&#123;systemProperties['pop3.port'] ?: 25&#125;"</span>)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>上例将注入系统属性 <code>pop3.port</code>，为空将注入 25。</p>
</blockquote>
<h3 id="安全导航运算符"><a href="#安全导航运算符" class="headerlink" title="安全导航运算符"></a>安全导航运算符</h3><p>安全导航运算符用于避免 <code>NullPointerException</code>，它来自 Groovy 语言。通常，当您引用一个对象时，可能需要在访问该对象的方法或属性之前验证其是否为 null。为了避免这种情况，安全导航运算符返回 null 而不是引发异常。 下面的示例演示如何使用安全导航操作符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();</span><br><span class="line"></span><br><span class="line">Inventor tesla = <span class="keyword">new</span> Inventor(<span class="string">"Nikola Tesla"</span>, <span class="string">"Serbian"</span>);</span><br><span class="line">tesla.setPlaceOfBirth(<span class="keyword">new</span> PlaceOfBirth(<span class="string">"Smiljan"</span>));</span><br><span class="line"></span><br><span class="line">String city = parser.parseExpression(<span class="string">"PlaceOfBirth?.City"</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(city);  <span class="comment">// Smiljan</span></span><br><span class="line"></span><br><span class="line">tesla.setPlaceOfBirth(<span class="keyword">null</span>);</span><br><span class="line">city = parser.parseExpression(<span class="string">"PlaceOfBirth?.City"</span>).getValue(context, tesla, String.class);</span><br><span class="line">System.out.println(city);  <span class="comment">// null - does not throw NullPointerException!!!</span></span><br></pre></td></tr></table></figure>

<h3 id="集合选择"><a href="#集合选择" class="headerlink" title="集合选择"></a>集合选择</h3><p>选择是一种强大的表达语言功能，可让您通过从源集合中进行选择来将其转换为另一个集合。</p>
<p>选择使用 <code>.?[selectionExpression]</code> 的语法。 它过滤集合并返回一个包含原始元素子集的新集合。例如，通过选择，我们可以轻松地获得 Serbian inventors 的列表，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Inventor&gt; list = (List&lt;Inventor&gt;) parser.parseExpression(</span><br><span class="line">        <span class="string">"Members.?[Nationality == 'Serbian']"</span>).getValue(societyContext);</span><br></pre></td></tr></table></figure>

<p>在列表和映射上都可以选择。对于列表，将针对每个单独的列表元素评估选择标准。针对映射，针对每个映射条目（Java 类型 Map.Entry 的对象）评估选择标准。每个映射条目都有其键和值，可作为属性访问以供选择。</p>
<p>以下表达式返回一个新映射，该映射由原始映射中条目值小于 27 的那些元素组成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map newMap = parser.parseExpression(<span class="string">"map.?[value&lt;27]"</span>).getValue();</span><br></pre></td></tr></table></figure>

<p>除了返回所有选定的元素外，您只能检索第一个或最后一个值。为了获得与选择匹配的第一个条目，语法为 <code>.^[selectionExpression]</code>。要获取最后一个匹配选择，语法为 <code>.$[selectionExpression]</code>。</p>
<h3 id="集合投影"><a href="#集合投影" class="headerlink" title="集合投影"></a>集合投影</h3><p>投影使集合可以驱动子表达式的求值，结果是一个新的集合。投影的语法为 <code>.![projectionExpression]</code>。例如，假设我们有一个 inventor 列表，但是想要他们出生的城市列表。实际上，我们希望为 inventor 列表中的每个条目计算“placeOfBirth.city”。 下面的示例使用投影来做到这一点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// returns [&apos;Smiljan&apos;, &apos;Idvor&apos; ]</span><br><span class="line">List placesOfBirth = (List)parser.parseExpression(&quot;Members.![placeOfBirth.city]&quot;);</span><br></pre></td></tr></table></figure>

<p>您还可以使用映射来驱动投影，在这种情况下，将针对映射中的每个条目（表示为 Java Map.Entry）对投影表达式进行评估。 跨映射的投影结果是一个列表，其中包含针对每个映射条目的投影表达式的评估。</p>
<h3 id="表达式模板"><a href="#表达式模板" class="headerlink" title="表达式模板"></a>表达式模板</h3><p>表达式模板允许将文字文本与一个或多个评估块混合。每个评估块均以您可以定义的前缀和后缀字符分隔。常见的选择是使用 <code>#{ }</code> 作为分隔符，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String randomPhrase = parser.parseExpression(</span><br><span class="line">        <span class="string">"random number is #&#123;T(java.lang.Math).random()&#125;"</span>,</span><br><span class="line">        <span class="keyword">new</span> TemplateParserContext()).getValue(String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// evaluates to "random number is 0.7038186818312008"</span></span><br></pre></td></tr></table></figure>

<p>通过将文字文本 <code>&#39;random number is &#39;</code> 与评估 <code>#{ }</code> 分隔符内的表达式的结果（在本例中为调用 <code>random()</code> 方法的结果）相连接来评估字符串。<code>parseExpression()</code> 方法的第二个参数的类型为 <code>ParserContext</code>。<code>ParserContext</code> 接口用于影响表达式的解析方式，以支持表达式模板功能。<code>TemplateParserContext</code> 的定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TemplateParserContext</span> <span class="keyword">implements</span> <span class="title">ParserContext</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getExpressionPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"#&#123;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getExpressionSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="示例中使用的类"><a href="#示例中使用的类" class="headerlink" title="示例中使用的类"></a>示例中使用的类</h2><p>本节列出了本章示例中使用的类。</p>
<p>Inventor.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.spring.samples.spel.inventor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.GregorianCalendar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Inventor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nationality;</span><br><span class="line">    <span class="keyword">private</span> String[] inventions;</span><br><span class="line">    <span class="keyword">private</span> Date birthdate;</span><br><span class="line">    <span class="keyword">private</span> PlaceOfBirth placeOfBirth;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Inventor</span><span class="params">(String name, String nationality)</span> </span>&#123;</span><br><span class="line">        GregorianCalendar c= <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.nationality = nationality;</span><br><span class="line">        <span class="keyword">this</span>.birthdate = c.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Inventor</span><span class="params">(String name, Date birthdate, String nationality)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.nationality = nationality;</span><br><span class="line">        <span class="keyword">this</span>.birthdate = birthdate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Inventor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNationality</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nationality;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNationality</span><span class="params">(String nationality)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nationality = nationality;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthdate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthdate</span><span class="params">(Date birthdate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthdate = birthdate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlaceOfBirth <span class="title">getPlaceOfBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> placeOfBirth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlaceOfBirth</span><span class="params">(PlaceOfBirth placeOfBirth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.placeOfBirth = placeOfBirth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInventions</span><span class="params">(String[] inventions)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.inventions = inventions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getInventions() &#123;</span><br><span class="line">        <span class="keyword">return</span> inventions;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PlaceOfBirth.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.spring.samples.spel.inventor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PlaceOfBirth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String country;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlaceOfBirth</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.city=city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlaceOfBirth</span><span class="params">(String city, String country)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(city);</span><br><span class="line">        <span class="keyword">this</span>.country = country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.city = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCountry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCountry</span><span class="params">(String country)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.country = country;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Society.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.spring.samples.spel.inventor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Society</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String Advisors = <span class="string">"advisors"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String President = <span class="string">"president"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Inventor&gt; members = <span class="keyword">new</span> ArrayList&lt;Inventor&gt;();</span><br><span class="line">    <span class="keyword">private</span> Map officers = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getMembers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> members;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">getOfficers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> officers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMember</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Inventor inventor : members) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inventor.getName().equals(name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/阅读/" rel="tag">#阅读</a>
          
            <a href="/tags/Spring/" rel="tag">#Spring</a>
          
            <a href="/tags/Java/" rel="tag">#Java</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/spring-4/" rel="next" title="Spring进阶 - 验证、数据绑定和类型转换">
                <i class="fa fa-chevron-left"></i> Spring进阶 - 验证、数据绑定和类型转换
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/spring-6/" rel="prev" title="Spring进阶 - Spring面向切面的编程（AOP）">
                Spring进阶 - Spring面向切面的编程（AOP） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2020/06/spring-5/" data-title="Spring进阶 - spring 表达式语言（SpEL）" data-url="https://HaleLu.github.io/2020/06/spring-5/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Hale Lu">
          <p class="site-author-name" itemprop="name">Hale Lu</p>
          <p class="site-description motion-element" itemprop="description">一只欠觉的开发狗</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">45</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/halelu" target="_blank" title="Github">
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/hao-lu-42-29" target="_blank" title="知乎">
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://wpa.qq.com/msgrd?v=3&uin=773622805&site=qq&menu=yes" target="_blank" title="QQ">
                  
                  QQ
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa fa-globe fa-fw"></i>
              各路大神
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://pmextra.github.io/" title="PM Extra's Blog" target="_blank">PM Extra's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://hzlclock.wordpress.com/" title="Hebert's Blog" target="_blank">Hebert's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.rexskz.info/" title="Rex's Blog" target="_blank">Rex's Blog</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#spring-表达式语言（SpEL）"><span class="nav-number">1.</span> <span class="nav-text">spring 表达式语言（SpEL）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#求值"><span class="nav-number">1.1.</span> <span class="nav-text">求值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#理解-EvaluationContext"><span class="nav-number">1.1.1.</span> <span class="nav-text">理解 EvaluationContext</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类型转换"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">类型转换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解析器配置"><span class="nav-number">1.1.2.</span> <span class="nav-text">解析器配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpEL-编译"><span class="nav-number">1.1.3.</span> <span class="nav-text">SpEL 编译</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#编译器配置"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">编译器配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译器限制"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">编译器限制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bean-定义中的表达式"><span class="nav-number">1.2.</span> <span class="nav-text">Bean 定义中的表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XML-配置"><span class="nav-number">1.2.1.</span> <span class="nav-text">XML 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解配置"><span class="nav-number">1.2.2.</span> <span class="nav-text">注解配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#语言参考"><span class="nav-number">1.3.</span> <span class="nav-text">语言参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#文字表达式"><span class="nav-number">1.3.1.</span> <span class="nav-text">文字表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#属性，数组，列表，映射和索引器"><span class="nav-number">1.3.2.</span> <span class="nav-text">属性，数组，列表，映射和索引器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内联列表"><span class="nav-number">1.3.3.</span> <span class="nav-text">内联列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内联映射"><span class="nav-number">1.3.4.</span> <span class="nav-text">内联映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构建数组"><span class="nav-number">1.3.5.</span> <span class="nav-text">构建数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法"><span class="nav-number">1.3.6.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运算符"><span class="nav-number">1.3.7.</span> <span class="nav-text">运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关系运算符"><span class="nav-number">1.3.7.1.</span> <span class="nav-text">关系运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#逻辑运算符"><span class="nav-number">1.3.7.2.</span> <span class="nav-text">逻辑运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数学运算符"><span class="nav-number">1.3.7.3.</span> <span class="nav-text">数学运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#赋值运算符"><span class="nav-number">1.3.7.4.</span> <span class="nav-text">赋值运算符</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类型"><span class="nav-number">1.3.8.</span> <span class="nav-text">类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构造器"><span class="nav-number">1.3.9.</span> <span class="nav-text">构造器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量"><span class="nav-number">1.3.10.</span> <span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#this-和-root-变量"><span class="nav-number">1.3.10.1.</span> <span class="nav-text">#this 和 #root 变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数"><span class="nav-number">1.3.11.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bean-引用"><span class="nav-number">1.3.12.</span> <span class="nav-text">Bean 引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三元表达式"><span class="nav-number">1.3.13.</span> <span class="nav-text">三元表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Elvis-运算符"><span class="nav-number">1.3.14.</span> <span class="nav-text">Elvis 运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安全导航运算符"><span class="nav-number">1.3.15.</span> <span class="nav-text">安全导航运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合选择"><span class="nav-number">1.3.16.</span> <span class="nav-text">集合选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合投影"><span class="nav-number">1.3.17.</span> <span class="nav-text">集合投影</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表达式模板"><span class="nav-number">1.3.18.</span> <span class="nav-text">表达式模板</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#示例中使用的类"><span class="nav-number">1.4.</span> <span class="nav-text">示例中使用的类</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hale Lu</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"halelu"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("ABk8fYaVcvf6P6IuuGNY2rRa-gzGzoHsz", "3Vpj3qkDsPj8Rlh92mHOxAMV");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
